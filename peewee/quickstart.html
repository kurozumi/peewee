

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>クイックスタート &mdash; peewee 2.10.2 ドキュメント</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/modified_theme.css" type="text/css" />
  

  

  
        <link rel="index" title="索引"
              href="../genindex.html"/>
        <link rel="search" title="検索" href="../search.html"/>
    <link rel="top" title="peewee 2.10.2 ドキュメント" href="../index.html"/>
        <link rel="next" title="サンプル・アプリケーション" href="example.html"/>
        <link rel="prev" title="インストールとテスト" href="installation.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> peewee
          

          
          </a>

          
            
            
              <div class="version">
                2.10.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">インストールとテスト</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">クイックスタート</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#model-definition">モデル定義</a></li>
<li class="toctree-l2"><a class="reference internal" href="#storing-data">データの保存</a></li>
<li class="toctree-l2"><a class="reference internal" href="#retrieving-data">データの取得</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#getting-single-records">Getting single records</a></li>
<li class="toctree-l3"><a class="reference internal" href="#lists-of-records">Lists of records</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-existing-databases">既存データベースの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-next">次は何？</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example.html">サンプル・アプリケーション</a></li>
<li class="toctree-l1"><a class="reference internal" href="more-resources.html">その他のリソース</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">貢献する</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">データベースの管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">モデルとフィールド</a></li>
<li class="toctree-l1"><a class="reference internal" href="querying.html">クエリ</a></li>
<li class="toctree-l1"><a class="reference internal" href="querying.html#query-operators">クエリ演算子</a></li>
<li class="toctree-l1"><a class="reference internal" href="querying.html#foreign-keys">外部キー</a></li>
<li class="toctree-l1"><a class="reference internal" href="querying.html#performance-techniques">パフォーマンステクニック</a></li>
<li class="toctree-l1"><a class="reference internal" href="transactions.html">トランザクション</a></li>
<li class="toctree-l1"><a class="reference internal" href="playhouse.html">Playhouse。Peeweeへの拡張</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">APIリファレンス</a></li>
<li class="toctree-l1"><a class="reference internal" href="hacks.html">Hacks</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">peewee</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>クイックスタート</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickstart">
<span id="id1"></span><h1>クイックスタート<a class="headerlink" href="#quickstart" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p>このドキュメントでは、Peeweeの主な機能のハイレベルな概要を簡単に説明します。</p>
<ul class="simple">
<li><a class="reference internal" href="#model-definition"><span class="std std-ref">モデル定義</span></a></li>
<li><a class="reference internal" href="#storing-data"><span class="std std-ref">データの保存</span></a></li>
<li><a class="reference internal" href="#retrieving-data"><span class="std std-ref">データの取得</span></a></li>
</ul>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">何かもう少し欲しい方は、peeweeとFlaskフレームワークを使った <a class="reference internal" href="example.html#example-app"><span class="std std-ref">creating a 「twitter」-style web app</span></a> というチュートリアルがあります。</p>
</div>
<p>I <strong>strongly</strong> recommend opening an interactive shell session and running the code. That way you can get a feel for typing in queries.</p>
<div class="section" id="model-definition">
<span id="id2"></span><h2>モデル定義<a class="headerlink" href="#model-definition" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Model classes, fields and model instances all map to database concepts:</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Thing</th>
<th class="head">Corresponds to…</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Model class</td>
<td>Database table</td>
</tr>
<tr class="row-odd"><td>Field instance</td>
<td>Column on a table</td>
</tr>
<tr class="row-even"><td>Model instance</td>
<td>Row in a database table</td>
</tr>
</tbody>
</table>
<p>When starting a project with peewee, it’s typically best to begin with your data model, by defining one or more <a class="reference internal" href="api.html#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> classes:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">peewee</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s1">&#39;people.db&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">birthday</span> <span class="o">=</span> <span class="n">DateField</span><span class="p">()</span>
    <span class="n">is_relative</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">db</span> <span class="c1"># This model uses the &quot;people.db&quot; database.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Note that we named our model <code class="docutils literal"><span class="pre">Person</span></code> instead of <code class="docutils literal"><span class="pre">People</span></code>. This is a convention you should follow – even though the table will contain multiple people, we always name the class using the singular form.</p>
</div>
<p>There are lots of <a class="reference internal" href="models.html#fields"><span class="std std-ref">field types</span></a> suitable for storing various types of data. Peewee handles converting between <em>pythonic</em> values those used by the database, so you can use Python types in your code without having to worry.</p>
<p>Things get interesting when we set up relationships between models using <a class="reference external" href="http://en.wikipedia.org/wiki/Foreign_key">foreign keys (wikipedia)</a>. This is easy to do with peewee:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Pet</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">owner</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;pets&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">animal_type</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">db</span> <span class="c1"># this model uses the &quot;people.db&quot; database</span>
</pre></div>
</div>
<p>Now that we have our models, let’s connect to the database. Although it’s not necessary to open the connection explicitly, it is good practice since it will reveal any errors with your database connection immediately, as opposed to some arbitrary time later when the first query is executed. It is also good to close the connection when you are done – for instance, a web app might open a connection when it receives a request, and close the connection when it sends the response.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</pre></div>
</div>
<p>We’ll begin by creating the tables in the database that will store our data. This will create the tables with the appropriate columns, indexes, sequences, and foreign key constraints:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">create_tables</span><span class="p">([</span><span class="n">Person</span><span class="p">,</span> <span class="n">Pet</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="storing-data">
<span id="id3"></span><h2>データの保存<a class="headerlink" href="#storing-data" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Let’s begin by populating the database with some people. We will use the <a class="reference internal" href="api.html#Model.save" title="Model.save"><code class="xref py py-meth docutils literal"><span class="pre">save()</span></code></a> and <a class="reference internal" href="api.html#Model.create" title="Model.create"><code class="xref py py-meth docutils literal"><span class="pre">create()</span></code></a> methods to add and update people’s records.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uncle_bob</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Bob&#39;</span><span class="p">,</span> <span class="n">birthday</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">1960</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">is_relative</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">uncle_bob</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> <span class="c1"># bob is now stored in the database</span>
<span class="go">1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">When you call <a class="reference internal" href="api.html#Model.save" title="Model.save"><code class="xref py py-meth docutils literal"><span class="pre">save()</span></code></a>, the number of rows modified is returned.</p>
</div>
<p>You can also add a person by calling the <a class="reference internal" href="api.html#Model.create" title="Model.create"><code class="xref py py-meth docutils literal"><span class="pre">create()</span></code></a> method, which returns a model instance:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">grandma</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Grandma&#39;</span><span class="p">,</span> <span class="n">birthday</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">1935</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">is_relative</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">herb</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Herb&#39;</span><span class="p">,</span> <span class="n">birthday</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">1950</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">is_relative</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<p>To update a row, modify the model instance and call <a class="reference internal" href="api.html#Model.save" title="Model.save"><code class="xref py py-meth docutils literal"><span class="pre">save()</span></code></a> to persist the changes. Here we will change Grandma’s name and then save the changes in the database:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">grandma</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Grandma L.&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grandma</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c1"># Update grandma&#39;s name in the database.</span>
<span class="go">1</span>
</pre></div>
</div>
<p>Now we have stored 3 people in the database. Let’s give them some pets. Grandma doesn’t like animals in the house, so she won’t have any, but Herb is an animal lover:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">bob_kitty</span> <span class="o">=</span> <span class="n">Pet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="n">uncle_bob</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Kitty&#39;</span><span class="p">,</span> <span class="n">animal_type</span><span class="o">=</span><span class="s1">&#39;cat&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">herb_fido</span> <span class="o">=</span> <span class="n">Pet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="n">herb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Fido&#39;</span><span class="p">,</span> <span class="n">animal_type</span><span class="o">=</span><span class="s1">&#39;dog&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">herb_mittens</span> <span class="o">=</span> <span class="n">Pet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="n">herb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Mittens&#39;</span><span class="p">,</span> <span class="n">animal_type</span><span class="o">=</span><span class="s1">&#39;cat&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">herb_mittens_jr</span> <span class="o">=</span> <span class="n">Pet</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">owner</span><span class="o">=</span><span class="n">herb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Mittens Jr&#39;</span><span class="p">,</span> <span class="n">animal_type</span><span class="o">=</span><span class="s1">&#39;cat&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>After a long full life, Mittens sickens and dies. We need to remove him from the database:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">herb_mittens</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">()</span> <span class="c1"># he had a great life</span>
<span class="go">1</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">The return value of <a class="reference internal" href="api.html#Model.delete_instance" title="Model.delete_instance"><code class="xref py py-meth docutils literal"><span class="pre">delete_instance()</span></code></a> is the number of rows removed from the database.</p>
</div>
<p>Uncle Bob decides that too many animals have been dying at Herb’s house, so he adopts Fido:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">herb_fido</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">uncle_bob</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">herb_fido</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">bob_fido</span> <span class="o">=</span> <span class="n">herb_fido</span> <span class="c1"># rename our variable for clarity</span>
</pre></div>
</div>
</div>
<div class="section" id="retrieving-data">
<span id="id4"></span><h2>データの取得<a class="headerlink" href="#retrieving-data" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>The real strength of our database is in how it allows us to retrieve data through <em>queries</em>. Relational databases are excellent for making ad-hoc queries.</p>
<div class="section" id="getting-single-records">
<h3>Getting single records<a class="headerlink" href="#getting-single-records" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Let’s retrieve Grandma’s record from the database. To get a single record from the database, use <a class="reference internal" href="api.html#SelectQuery.get" title="SelectQuery.get"><code class="xref py py-meth docutils literal"><span class="pre">SelectQuery.get()</span></code></a>:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">grandma</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Grandma L.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
<p>We can also use the equivalent shorthand <a class="reference internal" href="api.html#Model.get" title="Model.get"><code class="xref py py-meth docutils literal"><span class="pre">Model.get()</span></code></a>:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">grandma</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Grandma L.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="lists-of-records">
<h3>Lists of records<a class="headerlink" href="#lists-of-records" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Let’s list all the people in the database:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">Person</span><span class="o">.</span><span class="n">select</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">person</span><span class="o">.</span><span class="n">is_relative</span>
<span class="gp">...</span>
<span class="go">Bob True</span>
<span class="go">Grandma L. True</span>
<span class="go">Herb False</span>
</pre></div>
</div>
<p>Let’s list all the cats and their owner’s name:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="n">Pet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Pet</span><span class="o">.</span><span class="n">animal_type</span> <span class="o">==</span> <span class="s1">&#39;cat&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">pet</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">pet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pet</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">name</span>
<span class="gp">...</span>
<span class="go">Kitty Bob</span>
<span class="go">Mittens Jr Herb</span>
</pre></div>
</div>
<p>There is a big problem with the previous query: because we are accessing <code class="docutils literal"><span class="pre">pet.owner.name</span></code> and we did not select this value in our original query, peewee will have to perform an additional query to retrieve the pet’s owner. This behavior is referred to as <a class="reference internal" href="querying.html#nplusone"><span class="std std-ref">N+1</span></a> and it should generally be avoided.</p>
<p>We can avoid the extra queries by selecting both <em>Pet</em> and <em>Person</em>, and adding a <em>join</em>.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Pet</span>
<span class="gp">... </span>         <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Pet</span><span class="p">,</span> <span class="n">Person</span><span class="p">)</span>
<span class="gp">... </span>         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span>
<span class="gp">... </span>         <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Pet</span><span class="o">.</span><span class="n">animal_type</span> <span class="o">==</span> <span class="s1">&#39;cat&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">pet</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">pet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pet</span><span class="o">.</span><span class="n">owner</span><span class="o">.</span><span class="n">name</span>
<span class="gp">...</span>
<span class="go">Kitty Bob</span>
<span class="go">Mittens Jr Herb</span>
</pre></div>
</div>
<p>Let’s get all the pets owned by Bob:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">pet</span> <span class="ow">in</span> <span class="n">Pet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Bob&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">pet</span><span class="o">.</span><span class="n">name</span>
<span class="gp">...</span>
<span class="go">Kitty</span>
<span class="go">Fido</span>
</pre></div>
</div>
<p>We can do another cool thing here to get bob’s pets. Since we already have an object to represent Bob, we can do this instead:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">pet</span> <span class="ow">in</span> <span class="n">Pet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Pet</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">uncle_bob</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">pet</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p>Let’s make sure these are sorted alphabetically by adding an <a class="reference internal" href="api.html#SelectQuery.order_by" title="SelectQuery.order_by"><code class="xref py py-meth docutils literal"><span class="pre">order_by()</span></code></a> clause:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">pet</span> <span class="ow">in</span> <span class="n">Pet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Pet</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">uncle_bob</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Pet</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">pet</span><span class="o">.</span><span class="n">name</span>
<span class="gp">...</span>
<span class="go">Fido</span>
<span class="go">Kitty</span>
</pre></div>
</div>
<p>Let’s list all the people now, youngest to oldest:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">Person</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">birthday</span><span class="o">.</span><span class="n">desc</span><span class="p">()):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">person</span><span class="o">.</span><span class="n">birthday</span>
<span class="gp">...</span>
<span class="go">Bob 1960-01-15</span>
<span class="go">Herb 1950-05-05</span>
<span class="go">Grandma L. 1935-03-01</span>
</pre></div>
</div>
<p>Now let’s list all the people <em>and</em> some info about their pets:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">Person</span><span class="o">.</span><span class="n">select</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">person</span><span class="o">.</span><span class="n">pets</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="s1">&#39;pets&#39;</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">pet</span> <span class="ow">in</span> <span class="n">person</span><span class="o">.</span><span class="n">pets</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">print</span> <span class="s1">&#39;    &#39;</span><span class="p">,</span> <span class="n">pet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pet</span><span class="o">.</span><span class="n">animal_type</span>
<span class="gp">...</span>
<span class="go">Bob 2 pets</span>
<span class="go">    Kitty cat</span>
<span class="go">    Fido dog</span>
<span class="go">Grandma L. 0 pets</span>
<span class="go">Herb 1 pets</span>
<span class="go">    Mittens Jr cat</span>
</pre></div>
</div>
<p>Once again we’ve run into a classic example of <a class="reference internal" href="querying.html#nplusone"><span class="std std-ref">N+1</span></a> query behavior. We can avoid this by performing a <em>JOIN</em> and aggregating the records:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">subquery</span> <span class="o">=</span> <span class="n">Pet</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">COUNT</span><span class="p">(</span><span class="n">Pet</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Pet</span><span class="o">.</span><span class="n">owner</span> <span class="o">==</span> <span class="n">Person</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Person</span>
<span class="gp">... </span>         <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="n">Pet</span><span class="p">,</span> <span class="n">subquery</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;pet_count&#39;</span><span class="p">))</span>
<span class="gp">... </span>         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Pet</span><span class="p">,</span> <span class="n">JOIN</span><span class="o">.</span><span class="n">LEFT_OUTER</span><span class="p">)</span>
<span class="gp">... </span>         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">aggregate_rows</span><span class="p">():</span>  <span class="c1"># Note the `aggregate_rows()` call.</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">person</span><span class="o">.</span><span class="n">pet_count</span><span class="p">,</span> <span class="s1">&#39;pets&#39;</span>
<span class="gp">... </span>    <span class="k">for</span> <span class="n">pet</span> <span class="ow">in</span> <span class="n">person</span><span class="o">.</span><span class="n">pets</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">print</span> <span class="s1">&#39;    &#39;</span><span class="p">,</span> <span class="n">pet</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">pet</span><span class="o">.</span><span class="n">animal_type</span>
<span class="gp">...</span>
<span class="go">Bob 2 pets</span>
<span class="go">     Kitty cat</span>
<span class="go">     Fido dog</span>
<span class="go">Grandma L. 0 pets</span>
<span class="go">Herb 1 pets</span>
<span class="go">     Mittens Jr cat</span>
</pre></div>
</div>
<p>Even though we created the subquery separately, <strong>only one</strong> query is actually executed.</p>
<p>Finally, let’s do a complicated one. Let’s get all the people whose birthday was
either:</p>
<ul class="simple">
<li>before 1940 (grandma)</li>
<li>after 1959 (bob)</li>
</ul>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">d1940</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">1940</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d1960</span> <span class="o">=</span> <span class="n">date</span><span class="p">(</span><span class="mi">1960</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Person</span>
<span class="gp">... </span>         <span class="o">.</span><span class="n">select</span><span class="p">()</span>
<span class="gp">... </span>         <span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Person</span><span class="o">.</span><span class="n">birthday</span> <span class="o">&lt;</span> <span class="n">d1940</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">birthday</span> <span class="o">&gt;</span> <span class="n">d1960</span><span class="p">)))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">person</span><span class="o">.</span><span class="n">birthday</span>
<span class="gp">...</span>
<span class="go">Bob 1960-01-15</span>
<span class="go">Grandma L. 1935-03-01</span>
</pre></div>
</div>
<p>Now let’s do the opposite. People whose birthday is between 1940 and 1960:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Person</span>
<span class="gp">... </span>         <span class="o">.</span><span class="n">select</span><span class="p">()</span>
<span class="gp">... </span>         <span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">Person</span><span class="o">.</span><span class="n">birthday</span> <span class="o">&gt;</span> <span class="n">d1940</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">birthday</span> <span class="o">&lt;</span> <span class="n">d1960</span><span class="p">)))</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">person</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">person</span><span class="o">.</span><span class="n">birthday</span>
<span class="gp">...</span>
<span class="go">Herb 1950-05-05</span>
</pre></div>
</div>
<p>One last query. This will use a SQL function to find all people whose names start with either an upper or lower-case <em>G</em>:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">expression</span> <span class="o">=</span> <span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Lower</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Substr</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">person</span> <span class="ow">in</span> <span class="n">Person</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">expression</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">person</span><span class="o">.</span><span class="n">name</span>
<span class="gp">...</span>
<span class="go">Grandma L.</span>
</pre></div>
</div>
<p>We’re done with our database, let’s close the connection:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">db</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>This is just the basics! You can make your queries as complex as you like.</p>
<p>All the other SQL clauses are available as well, such as:</p>
<ul class="simple">
<li><a class="reference internal" href="api.html#SelectQuery.group_by" title="SelectQuery.group_by"><code class="xref py py-meth docutils literal"><span class="pre">group_by()</span></code></a></li>
<li><a class="reference internal" href="api.html#SelectQuery.having" title="SelectQuery.having"><code class="xref py py-meth docutils literal"><span class="pre">having()</span></code></a></li>
<li><a class="reference internal" href="api.html#SelectQuery.limit" title="SelectQuery.limit"><code class="xref py py-meth docutils literal"><span class="pre">limit()</span></code></a> and <a class="reference internal" href="api.html#SelectQuery.offset" title="SelectQuery.offset"><code class="xref py py-meth docutils literal"><span class="pre">offset()</span></code></a></li>
</ul>
<p>Check the documentation on <a class="reference internal" href="querying.html#querying"><span class="std std-ref">クエリ</span></a> for more info.</p>
</div>
</div>
<div class="section" id="working-with-existing-databases">
<h2>既存データベースの操作<a class="headerlink" href="#working-with-existing-databases" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>If you already have a database, you can autogenerate peewee models using <a class="reference internal" href="playhouse.html#pwiz"><span class="std std-ref">pwiz、モデルジェネレータ</span></a>. For instance, if I have a postgresql database named <em>charles_blog</em>, I might run:</p>
<div class="highlight-console"><div class="highlight"><pre><span></span><span class="go">python -m pwiz -e postgresql charles_blog &gt; blog_models.py</span>
</pre></div>
</div>
</div>
<div class="section" id="what-next">
<h2>次は何？<a class="headerlink" href="#what-next" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>That’s it for the quickstart. If you want to look at a full web-app, check out the <a class="reference internal" href="example.html#example-app"><span class="std std-ref">サンプル・アプリケーション</span></a>.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="example.html" class="btn btn-neutral float-right" title="サンプル・アプリケーション" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral" title="インストールとテスト" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright charles leifer.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.10.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>