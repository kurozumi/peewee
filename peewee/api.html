

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>APIリファレンス &mdash; peewee 2.10.2 ドキュメント</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/modified_theme.css" type="text/css" />
  

  

  
        <link rel="index" title="索引"
              href="../genindex.html"/>
        <link rel="search" title="検索" href="../search.html"/>
    <link rel="top" title="peewee 2.10.2 ドキュメント" href="../index.html"/>
        <link rel="next" title="Hacks" href="hacks.html"/>
        <link rel="prev" title="Playhouse。Peeweeへの拡張" href="playhouse.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> peewee
          

          
          </a>

          
            
            
              <div class="version">
                2.10.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">インストールとテスト</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">クイックスタート</a></li>
<li class="toctree-l1"><a class="reference internal" href="example.html">サンプル・アプリケーション</a></li>
<li class="toctree-l1"><a class="reference internal" href="more-resources.html">その他のリソース</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">貢献する</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">データベースの管理</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">モデルとフィールド</a></li>
<li class="toctree-l1"><a class="reference internal" href="querying.html">クエリ</a></li>
<li class="toctree-l1"><a class="reference internal" href="querying.html#query-operators">クエリ演算子</a></li>
<li class="toctree-l1"><a class="reference internal" href="querying.html#foreign-keys">外部キー</a></li>
<li class="toctree-l1"><a class="reference internal" href="querying.html#performance-techniques">パフォーマンステクニック</a></li>
<li class="toctree-l1"><a class="reference internal" href="transactions.html">トランザクション</a></li>
<li class="toctree-l1"><a class="reference internal" href="playhouse.html">Playhouse。Peeweeへの拡張</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">APIリファレンス</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#models">モデル</a></li>
<li class="toctree-l2"><a class="reference internal" href="#fields">フィールド</a></li>
<li class="toctree-l2"><a class="reference internal" href="#query-types">クエリの種類</a></li>
<li class="toctree-l2"><a class="reference internal" href="#database-and-its-subclasses">データベースとそのサブクエリ</a></li>
<li class="toctree-l2"><a class="reference internal" href="#transaction-savepoint-and-executioncontext">トランザクション、セーブポイントおよびExecutionContext</a></li>
<li class="toctree-l2"><a class="reference internal" href="#metadata-types">メタデータの種類</a></li>
<li class="toctree-l2"><a class="reference internal" href="#misc">その他</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hacks.html">Hacks</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">peewee</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>APIリファレンス</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
<div class="note" style="text-align:center">
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- kurozumi.github.io/peewee/ 336*280 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:336px;height:280px"
     data-ad-client="ca-pub-6843356127740583"
     data-ad-slot="2268187197"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
</div>

<div class="section" id="api-reference">
<span id="api"></span><h1>APIリファレンス<a class="headerlink" href="#api-reference" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="section" id="models">
<span id="model-api"></span><h2>モデル<a class="headerlink" href="#models" title="このヘッドラインへのパーマリンク">¶</a></h2>
<dl class="class">
<dt id="Model">
<em class="property">class </em><code class="descname">Model</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#Model" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>モデルはデータベーステーブルに1対1のマッピングを提供します。<code class="docutils literal"><span class="pre">Model</span></code> のサブクラスは、任意の数の <code class="xref py py-class docutils literal"><span class="pre">Field</span></code> インスタンスをクラス属性として宣言します。これらのフィールドは、テーブルカラムに対応しています。</p>
<p><a class="reference internal" href="#Model.select" title="Model.select"><code class="xref py py-meth docutils literal"><span class="pre">select()</span></code></a>、<a class="reference internal" href="#Model.update" title="Model.update"><code class="xref py py-meth docutils literal"><span class="pre">update()</span></code></a>、<a class="reference internal" href="#Model.insert" title="Model.insert"><code class="xref py py-meth docutils literal"><span class="pre">insert()</span></code></a>、<a class="reference internal" href="#Model.delete" title="Model.delete"><code class="xref py py-meth docutils literal"><span class="pre">delete()</span></code></a> などのテーブルレベルの操作はクラスメソッドとして実装されています。<a class="reference internal" href="#Model.save" title="Model.save"><code class="xref py py-meth docutils literal"><span class="pre">save()</span></code></a> や <a class="reference internal" href="#Model.delete_instance" title="Model.delete_instance"><code class="xref py py-meth docutils literal"><span class="pre">delete_instance()</span></code></a> などの行レベルの操作は、インスタンスメソッドとして実装されています。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>kwargs</strong> – モデルを初期化し、与えられたキー/バリューを適切なフィールドに割り当てます。</td>
</tr>
</tbody>
</table>
<p>例:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">join_date</span> <span class="o">=</span> <span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
    <span class="n">is_admin</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">()</span>

<span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="n">is_admin</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<dl class="classmethod">
<dt id="Model.select">
<em class="property">classmethod </em><code class="descname">select</code><span class="sig-paren">(</span><em>*selection</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.select" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>selection</strong> – モデルクラス、フィールドインスタンス、関数、または式のリスト。引数が指定されていない場合は、指定されたモデルのすべての列が選択されます。</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">指定された <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> の :py:class*`SelectQuery` 。</td>
</tr>
</tbody>
</table>
<p>すべてのカラムを選択する例（デフォルト）:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
</pre></div>
</div>
<p><em>Tweet</em> のすべてのカラムと親モデル <em>User</em> を選択する例</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">Tweet</span>
  <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">User</span><span class="p">)</span>
  <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
  <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="o">.</span><span class="n">desc</span><span class="p">()))</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.update">
<em class="property">classmethod </em><code class="descname">update</code><span class="sig-paren">(</span><em>**update</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.update" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>update</strong> – フィールド名から式へのマッピング</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">指定された <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> の <a class="reference internal" href="#UpdateQuery" title="UpdateQuery"><code class="xref py py-class docutils literal"><span class="pre">UpdateQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>ユーザーの登録が失効した場合に非アクティブとマークされていることを示す例:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">registration_expired</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c1"># Execute the query, updating the database.</span>
</pre></div>
</div>
<p>アトミック更新を示す例:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">PageView</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="n">PageView</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="n">url</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c1"># execute the query, updating the database.</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">更新クエリが実行されると、変更された行の数が返されます。</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.insert">
<em class="property">classmethod </em><code class="descname">insert</code><span class="sig-paren">(</span><em>**insert</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.insert" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>新しい行をデータベースに挿入します。モデルのいずれかのフィールドにデフォルト値がある場合、フィールドが <code class="docutils literal"><span class="pre">insert</span></code> ディクショナリに明示的に設定されていなければデフォルト値が使用されます。</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>insert</strong> – フィールドまたはフィールド名から式へのマッピング。</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">指定された <code class="xref py py-class docutils literal"><span class="pre">Model`の</span> <span class="pre">:py:class:`InsertQuery</span></code></td>
</tr>
</tbody>
</table>
<p>新しいユーザーの作成を示す例：</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">registration_expired</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c1"># perform the insert.</span>
</pre></div>
</div>
<p><code class="xref py py-class docutils literal"><span class="pre">Field</span></code> オブジェクトをキーとして使用することもできます:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">User</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<p>いずれかのフィールドにデフォルト値を持つモデルがあり、そのフィールドが <code class="docutils literal"><span class="pre">insert</span></code> パラメーターで指定されていない場合は、デフォルトが使用されます:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">active</span> <span class="o">=</span> <span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># This INSERT query will automatically specify `active=True`:</span>
<span class="n">User</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;charlie&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">オートインクリメントの主キーを持つテーブルで挿入クエリを実行すると、新しい行の主キーが返されます。</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Model.insert_many">
<code class="descname">insert_many</code><span class="sig-paren">(</span><em>rows</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.insert_many" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>一度に複数の行を挿入します。<code class="docutils literal"><span class="pre">rows</span></code> パラメーターは、辞書でなければなりません。<a class="reference internal" href="#Model.insert" title="Model.insert"><code class="xref py py-meth docutils literal"><span class="pre">Model.insert()</span></code></a> の場合と同様に、ディクショナリに指定されていないフィールドは、デフォルト値（存在する場合）を使用します。</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>一括挿入の性質上、各行には同じフィールドが含まれている必要があります。以下は動作しません:</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span><span class="n">Person</span><span class="o">.</span><span class="n">insert_many</span><span class="p">([</span>
    <span class="p">{</span><span class="s1">&#39;first_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Peewee&#39;</span><span class="p">,</span> <span class="s1">&#39;last_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Herman&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;first_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Huey&#39;</span><span class="p">},</span>  <span class="c1"># Missing &quot;last_name&quot;!</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>rows</strong> – フィールド名と値がセットのディクショナリを含むリスト。</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">指定された <code class="xref py py-class docutils literal"><span class="pre">Model`の</span> <span class="pre">:py:class:`InsertQuery</span></code></td>
</tr>
</tbody>
</table>
<p>複数のユーザーを挿入する例:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">usernames</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="s1">&#39;huey&#39;</span><span class="p">,</span> <span class="s1">&#39;peewee&#39;</span><span class="p">,</span> <span class="s1">&#39;mickey&#39;</span><span class="p">]</span>
<span class="n">row_dicts</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">}</span> <span class="k">for</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">usernames</span><span class="p">)</span>

<span class="c1"># Insert 4 new rows.</span>
<span class="n">User</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">row_dicts</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">rows</span></code> パラメータは任意の反復可能なものにすることができるため、ジェネレータを使用することもできます:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_usernames</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">username</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="s1">&#39;huey&#39;</span><span class="p">,</span> <span class="s1">&#39;peewee&#39;</span><span class="p">]:</span>
        <span class="k">yield</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">}</span>
<span class="n">User</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">get_usernames</span><span class="p">())</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">SQLiteを使用している場合、一括挿入を利用するには、SQLiteライブラリのバージョンが3.7.11以降である必要があります。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>SQLiteには、ステートメントごとに999のバウンド変数のデフォルト制限があります。この制限はコンパイル時または実行時に変更できますが、実行時に変更する場合はデフォルトの制限よりも小さい値しか指定できません。</p>
<p>For more information, check out the following SQLite documents:</p>
<ul class="last simple">
<li><a class="reference external" href="https://www.sqlite.org/limits.html#max_variable_number">Max variable number limit</a></li>
<li><a class="reference external" href="https://www.sqlite.org/c3ref/limit.html">Changing run-time limits</a></li>
<li><a class="reference external" href="https://www.sqlite.org/compile.html">SQLite compile-time flags</a></li>
</ul>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.insert_from">
<em class="property">classmethod </em><code class="descname">insert_from</code><span class="sig-paren">(</span><em>fields</em>, <em>query</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.insert_from" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Insert rows into the table using a query as the data source. This API should
be used for <em>INSERT INTO…SELECT FROM</em> queries.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first simple">
<li><strong>fields</strong> – The field objects to map the selected data into.</li>
<li><strong>query</strong> – The source of the new rows.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><p class="first last">指定された <code class="xref py py-class docutils literal"><span class="pre">Model`の</span> <span class="pre">:py:class:`InsertQuery</span></code></p>
</td>
</tr>
</tbody>
</table>
<p>Example of inserting data across tables for denormalization purposes:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
          <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">COUNT</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
          <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">JOIN</span><span class="o">.</span><span class="n">LEFT_OUTER</span><span class="p">)</span>
          <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
<span class="n">UserTweetDenorm</span><span class="o">.</span><span class="n">insert_from</span><span class="p">(</span>
    <span class="p">[</span><span class="n">UserTweetDenorm</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">UserTweetDenorm</span><span class="o">.</span><span class="n">num_tweets</span><span class="p">],</span>
    <span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.delete">
<em class="property">classmethod </em><code class="descname">delete</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.delete" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">a <a class="reference internal" href="#DeleteQuery" title="DeleteQuery"><code class="xref py py-class docutils literal"><span class="pre">DeleteQuery</span></code></a> for the given <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a>.</td>
</tr>
</tbody>
</table>
<p>Example showing the deletion of all inactive users:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)</span>
<span class="n">q</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c1"># remove the rows</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">This method performs a delete on the <em>entire table</em>. To delete a
single instance, see <a class="reference internal" href="#Model.delete_instance" title="Model.delete_instance"><code class="xref py py-meth docutils literal"><span class="pre">Model.delete_instance()</span></code></a>.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.raw">
<em class="property">classmethod </em><code class="descname">raw</code><span class="sig-paren">(</span><em>sql</em>, <em>*params</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.raw" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first simple">
<li><strong>sql</strong> – a string SQL expression</li>
<li><strong>params</strong> – any number of parameters to interpolate</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><p class="first last">a <a class="reference internal" href="#RawQuery" title="RawQuery"><code class="xref py py-class docutils literal"><span class="pre">RawQuery</span></code></a> for the given <code class="docutils literal"><span class="pre">Model</span></code></p>
</td>
</tr>
</tbody>
</table>
<p>Example selecting rows from the User table:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">q</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="s1">&#39;select id, username from users&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">q</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Generally the use of <code class="docutils literal"><span class="pre">raw</span></code> is reserved for those cases where you
can significantly optimize a select query. It is useful for select
queries since it will return instances of the model.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.create">
<em class="property">classmethod </em><code class="descname">create</code><span class="sig-paren">(</span><em>**attributes</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.create" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>attributes</strong> – key/value pairs of model attributes</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">a model instance with the provided attributes</td>
</tr>
</tbody>
</table>
<p>Example showing the creation of a user (a row will be added to the
database):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">The create() method is a shorthand for instantiate-then-save.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.get">
<em class="property">classmethod </em><code class="descname">get</code><span class="sig-paren">(</span><em>*args</em><span class="sig-paren">)</span><a class="headerlink" href="#Model.get" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>args</strong> – a list of query expressions, e.g. <code class="docutils literal"><span class="pre">User.username</span> <span class="pre">==</span> <span class="pre">'foo'</span></code></td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> instance or raises <code class="docutils literal"><span class="pre">DoesNotExist</span></code> exception</td>
</tr>
</tbody>
</table>
<p>Get a single row from the database that matches the given query.
Raises a <code class="docutils literal"><span class="pre">&lt;model-class&gt;.DoesNotExist</span></code> if no rows are returned:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>This method is also exposed via the <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a>, though it
takes no parameters:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">active</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">active</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="k">except</span> <span class="n">User</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">The <a class="reference internal" href="#Model.get" title="Model.get"><code class="xref py py-meth docutils literal"><span class="pre">get()</span></code></a> method is shorthand for selecting with a limit of 1. It
has the added behavior of raising an exception when no matching row is
found. If more than one row is found, the first row returned by the
database cursor will be used.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.get_or_create">
<em class="property">classmethod </em><code class="descname">get_or_create</code><span class="sig-paren">(</span><span class="optional">[</span><em>defaults=None</em><span class="optional">[</span>, <em>**kwargs</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.get_or_create" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first simple">
<li><strong>defaults</strong> (<em>dict</em>) – A dictionary of values to set on newly-created model instances.</li>
<li><strong>kwargs</strong> – Django-style filters specifying which model to get, and what values to apply to new instances.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値:</th><td class="field-body"><p class="first last">A 2-tuple containing the model instance and a boolean indicating whether the instance was created.</p>
</td>
</tr>
</tbody>
</table>
<p>This function attempts to retrieve a model instance based on the provided filters. If no matching model can be found, a new model is created using the parameters specified by the filters and any values in the <code class="docutils literal"><span class="pre">defaults</span></code> dictionary.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Use care when calling <code class="docutils literal"><span class="pre">get_or_create</span></code> with <code class="docutils literal"><span class="pre">autocommit=False</span></code>, as the <code class="docutils literal"><span class="pre">get_or_create()</span></code> method will call <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">Database.atomic()</span></code></a> to create either a transaction or savepoint.</p>
</div>
<p>Example <strong>without</strong> <code class="docutils literal"><span class="pre">get_or_create</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Without `get_or_create`, we might write:</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">first_name</span> <span class="o">==</span> <span class="s1">&#39;John&#39;</span><span class="p">)</span> <span class="o">&amp;</span>
        <span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">last_name</span> <span class="o">==</span> <span class="s1">&#39;Lennon&#39;</span><span class="p">))</span>
<span class="k">except</span> <span class="n">Person</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
    <span class="n">person</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
        <span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;John&#39;</span><span class="p">,</span>
        <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;Lennon&#39;</span><span class="p">,</span>
        <span class="n">birthday</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
</pre></div>
</div>
<p>Equivalent code using <code class="docutils literal"><span class="pre">get_or_create</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">person</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
    <span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;John&#39;</span><span class="p">,</span>
    <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;Lennon&#39;</span><span class="p">,</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;birthday&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">)})</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.alias">
<em class="property">classmethod </em><code class="descname">alias</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.alias" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><code class="xref py py-class docutils literal"><span class="pre">ModelAlias</span></code> instance</td>
</tr>
</tbody>
</table>
<p>The <a class="reference internal" href="#Model.alias" title="Model.alias"><code class="xref py py-meth docutils literal"><span class="pre">alias()</span></code></a> method is used to create self-joins.</p>
<p>例:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="go">Parent = Category.alias()</span>
<span class="go">sq = (Category</span>
<span class="go">      .select(Category, Parent)</span>
<span class="go">      .join(Parent, on=(Category.parent == Parent.id))</span>
<span class="go">      .where(Parent.name == &#39;parent category&#39;))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">When using a <code class="xref py py-class docutils literal"><span class="pre">ModelAlias</span></code> in a join, you must explicitly specify the join condition.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.create_table">
<em class="property">classmethod </em><code class="descname">create_table</code><span class="sig-paren">(</span><span class="optional">[</span><em>fail_silently=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.create_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>fail_silently</strong> (<em>bool</em>) – If set to <code class="docutils literal"><span class="pre">True</span></code>, the method will check
for the existence of the table before attempting to create.</td>
</tr>
</tbody>
</table>
<p>Create the table for the given model, along with any constraints and indexes.</p>
<p>例:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">database</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="n">SomeModel</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>  <span class="c1"># Execute the create table query.</span>
</pre></div>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Model.drop_table">
<em class="property">classmethod </em><code class="descname">drop_table</code><span class="sig-paren">(</span><span class="optional">[</span><em>fail_silently=False</em><span class="optional">[</span>, <em>cascade=False</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.drop_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>fail_silently</strong> (<em>bool</em>) – If set to <code class="docutils literal"><span class="pre">True</span></code>, the query will check for
the existence of the table before attempting to remove.</li>
<li><strong>cascade</strong> (<em>bool</em>) – Drop table with <code class="docutils literal"><span class="pre">CASCADE</span></code> option.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Drop the table for the given model.</p>
</dd></dl>

<dl class="classmethod">
<dt id="Model.table_exists">
<em class="property">classmethod </em><code class="descname">table_exists</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.table_exists" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">Boolean whether the table for this model exists in the database</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="Model.sqlall">
<em class="property">classmethod </em><code class="descname">sqlall</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.sqlall" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値:</th><td class="field-body">A list of queries required to create the table and indexes.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Model.save">
<code class="descname">save</code><span class="sig-paren">(</span><span class="optional">[</span><em>force_insert=False</em><span class="optional">[</span>, <em>only=None</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.save" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>force_insert</strong> (<em>bool</em>) – Whether to force execution of an insert</li>
<li><strong>only</strong> (<em>list</em>) – A list of fields to persist – when supplied, only the given
fields will be persisted.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Save the given instance, creating or updating depending on whether it has a
primary key.  If <code class="docutils literal"><span class="pre">force_insert=True</span></code> an <em>INSERT</em> will be issued regardless
of whether or not the primary key exists.</p>
<p>Example showing saving a model instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
<span class="n">user</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;some-user&#39;</span>  <span class="c1"># does not touch the database</span>
<span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c1"># change is persisted to the db</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Model.delete_instance">
<code class="descname">delete_instance</code><span class="sig-paren">(</span><span class="optional">[</span><em>recursive=False</em><span class="optional">[</span>, <em>delete_nullable=False</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.delete_instance" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>recursive</strong> – Delete this instance and anything that depends on it,
optionally updating those that have nullable dependencies</li>
<li><strong>delete_nullable</strong> – If doing a recursive delete, delete all dependent
objects regardless of whether it could be updated to NULL</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Delete the given instance.  Any foreign keys set to cascade on
delete will be deleted automatically.  For more programmatic control,
you can call with recursive=True, which will delete any non-nullable
related models (those that <em>are</em> nullable will be set to NULL).  If you
wish to delete all dependencies regardless of whether they are nullable,
set <code class="docutils literal"><span class="pre">delete_nullable=True</span></code>.</p>
<p>example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">some_obj</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">()</span>  <span class="c1"># it is gone forever</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Model.dependencies">
<code class="descname">dependencies</code><span class="sig-paren">(</span><span class="optional">[</span><em>search_nullable=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.dependencies" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>search_nullable</strong> (<em>bool</em>) – Search models related via a nullable foreign key</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">Generator expression yielding queries and foreign key fields</td>
</tr>
</tbody>
</table>
<p>Generate a list of queries of dependent models.  Yields a 2-tuple containing
the query and corresponding foreign key field.  Useful for searching dependencies
of a model, i.e. things that would be orphaned in the event of a delete.</p>
</dd></dl>

<dl class="attribute">
<dt id="Model.dirty_fields">
<code class="descname">dirty_fields</code><a class="headerlink" href="#Model.dirty_fields" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Return a list of fields that were manually set.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>If you just want to persist modified fields, you can call
<code class="docutils literal"><span class="pre">model.save(only=model.dirty_fields)</span></code>.</p>
<p>If you <strong>always</strong> want to only save a model’s dirty fields, you can use the Meta
option <code class="docutils literal"><span class="pre">only_save_dirty</span> <span class="pre">=</span> <span class="pre">True</span></code>. Then, any time you call <a class="reference internal" href="#Model.save" title="Model.save"><code class="xref py py-meth docutils literal"><span class="pre">Model.save()</span></code></a>,
by default only the dirty fields will be saved, e.g.</p>
<div class="last highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">dob</span> <span class="o">=</span> <span class="n">DateField</span><span class="p">()</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">db</span>
        <span class="n">only_save_dirty</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="method">
<dt id="Model.is_dirty">
<code class="descname">is_dirty</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.is_dirty" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Return whether any fields were manually set.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">bool</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Model.prepared">
<code class="descname">prepared</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Model.prepared" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>This method provides a hook for performing model initialization <em>after</em>
the row data has been populated.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="fields">
<span id="fields-api"></span><h2>フィールド<a class="headerlink" href="#fields" title="このヘッドラインへのパーマリンク">¶</a></h2>
<dl class="class">
<dt>
<code class="descname">Field(null=False, index=False, unique=False, verbose_name=None, help_text=None, db_column=None, default=None, choices=None, primary_key=False, sequence=None, constraints=None, schema=None, **kwargs):</code></dt>
<dd><p>The base class from which all other field types extend.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>null</strong> (<em>bool</em>) – whether this column can accept <code class="docutils literal"><span class="pre">None</span></code> or <code class="docutils literal"><span class="pre">NULL</span></code> values</li>
<li><strong>index</strong> (<em>bool</em>) – whether to create an index for this column when creating the table</li>
<li><strong>unique</strong> (<em>bool</em>) – whether to create a unique index for this column when creating the table</li>
<li><strong>verbose_name</strong> (<em>string</em>) – specify a 「verbose name」 for this field, useful for metadata purposes</li>
<li><strong>help_text</strong> (<em>string</em>) – specify some instruction text for the usage/meaning of this field</li>
<li><strong>db_column</strong> (<em>string</em>) – column name to use for underlying storage, useful for compatibility with legacy databases</li>
<li><strong>default</strong> – a value to use as an uninitialized default</li>
<li><strong>choices</strong> – an iterable of 2-tuples mapping <code class="docutils literal"><span class="pre">value</span></code> to <code class="docutils literal"><span class="pre">display</span></code></li>
<li><strong>primary_key</strong> (<em>bool</em>) – whether to use this as the primary key for the table</li>
<li><strong>sequence</strong> (<em>string</em>) – name of sequence (if backend supports it)</li>
<li><strong>constraints</strong> (<em>list</em>) – a list of constraints, e.g. <code class="docutils literal"><span class="pre">[Check('price</span> <span class="pre">&gt;</span> <span class="pre">0')]</span></code>.</li>
<li><strong>schema</strong> (<em>string</em>) – name of schema (if backend supports it)</li>
<li><strong>kwargs</strong> – named attributes containing values that may pertain to specific field subclasses, such as 「max_length」 or 「decimal_places」</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt>
<code class="descname">db_field = '&lt;some field type&gt;'</code></dt>
<dd><p>Attribute used to map this field to a column type, e.g. 「string」 or 「datetime」</p>
</dd></dl>

<dl class="attribute">
<dt id="_is_bound">
<code class="descname">_is_bound</code><a class="headerlink" href="#_is_bound" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Boolean flag indicating if the field is attached to a model class.</p>
</dd></dl>

<dl class="attribute">
<dt id="model_class">
<code class="descname">model_class</code><a class="headerlink" href="#model_class" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The model the field belongs to. <em>Only applies to bound fields.</em></p>
</dd></dl>

<dl class="attribute">
<dt id="name">
<code class="descname">name</code><a class="headerlink" href="#name" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The name of the field. <em>Only applies to bound fields.</em></p>
</dd></dl>

<dl class="method">
<dt id="db_value">
<code class="descname">db_value</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#db_value" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>value</strong> – python data type to prep for storage in the database</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">converted python datatype</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="python_value">
<code class="descname">python_value</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#python_value" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>value</strong> – data coming from the backend storage</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">python data type</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="coerce">
<code class="descname">coerce</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#coerce" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>This method is a shorthand that is used, by default, by both <code class="docutils literal"><span class="pre">db_value</span></code> and
<code class="docutils literal"><span class="pre">python_value</span></code>.  You can usually get away with just implementing this.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>value</strong> – arbitrary data from app or backend</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">python data type</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="IntegerField">
<em class="property">class </em><code class="descname">IntegerField</code><a class="headerlink" href="#IntegerField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: integers</p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'int'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="BigIntegerField">
<em class="property">class </em><code class="descname">BigIntegerField</code><a class="headerlink" href="#BigIntegerField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: big integers</p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'bigint'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="PrimaryKeyField">
<em class="property">class </em><code class="descname">PrimaryKeyField</code><a class="headerlink" href="#PrimaryKeyField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: auto-incrementing integer fields suitable for use as primary key.</p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'primary_key'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="FloatField">
<em class="property">class </em><code class="descname">FloatField</code><a class="headerlink" href="#FloatField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: floating-point numbers</p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'float'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="DoubleField">
<em class="property">class </em><code class="descname">DoubleField</code><a class="headerlink" href="#DoubleField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: double-precision floating-point numbers</p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'double'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="DecimalField">
<em class="property">class </em><code class="descname">DecimalField</code><a class="headerlink" href="#DecimalField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: decimal numbers, using python standard library <code class="docutils literal"><span class="pre">Decimal</span></code> objects</p>
<p>Additional attributes and values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">max_digits</span></code></td>
<td><code class="docutils literal"><span class="pre">10</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">decimal_places</span></code></td>
<td><code class="docutils literal"><span class="pre">5</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">auto_round</span></code></td>
<td><code class="docutils literal"><span class="pre">False</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">rounding</span></code></td>
<td><code class="docutils literal"><span class="pre">decimal.DefaultContext.rounding</span></code></td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'decimal'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="CharField">
<em class="property">class </em><code class="descname">CharField</code><a class="headerlink" href="#CharField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: small strings (0-255 bytes)</p>
<p>Additional attributes and values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="39%" />
<col width="61%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">max_length</span></code></td>
<td><code class="docutils literal"><span class="pre">255</span></code></td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'string'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="TextField">
<em class="property">class </em><code class="descname">TextField</code><a class="headerlink" href="#TextField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: arbitrarily large strings</p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'text'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="DateTimeField">
<em class="property">class </em><code class="descname">DateTimeField</code><a class="headerlink" href="#DateTimeField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: python <code class="docutils literal"><span class="pre">datetime.datetime</span></code> instances</p>
<p>Accepts a special parameter <code class="docutils literal"><span class="pre">formats</span></code>, which contains a list of formats
the datetime can be encoded with.  The default behavior is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="c1"># year-month-day hour-minute-second.microsecond</span>
<span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span> <span class="c1"># year-month-day hour-minute-second</span>
<span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="c1"># year-month-day</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">If the incoming value does not match a format, it will be returned as-is</p>
</div>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'datetime'</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="DateTimeField.year">
<code class="descname">year</code><a class="headerlink" href="#DateTimeField.year" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>An expression suitable for extracting the year, for example to retrieve
all blog posts from 2013:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Blog</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Blog</span><span class="o">.</span><span class="n">pub_date</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2013</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="DateTimeField.month">
<code class="descname">month</code><a class="headerlink" href="#DateTimeField.month" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>An expression suitable for extracting the month from a stored date.</p>
</dd></dl>

<dl class="attribute">
<dt id="DateTimeField.day">
<code class="descname">day</code><a class="headerlink" href="#DateTimeField.day" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>An expression suitable for extracting the day from a stored date.</p>
</dd></dl>

<dl class="attribute">
<dt id="DateTimeField.hour">
<code class="descname">hour</code><a class="headerlink" href="#DateTimeField.hour" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>An expression suitable for extracting the hour from a stored time.</p>
</dd></dl>

<dl class="attribute">
<dt id="DateTimeField.minute">
<code class="descname">minute</code><a class="headerlink" href="#DateTimeField.minute" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>An expression suitable for extracting the minute from a stored time.</p>
</dd></dl>

<dl class="attribute">
<dt id="DateTimeField.second">
<code class="descname">second</code><a class="headerlink" href="#DateTimeField.second" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>An expression suitable for extracting the second from a stored time.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="DateField">
<em class="property">class </em><code class="descname">DateField</code><a class="headerlink" href="#DateField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: python <code class="docutils literal"><span class="pre">datetime.date</span></code> instances</p>
<p>Accepts a special parameter <code class="docutils literal"><span class="pre">formats</span></code>, which contains a list of formats
the date can be encoded with.  The default behavior is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="c1"># year-month-day</span>
<span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span> <span class="c1"># year-month-day hour-minute-second</span>
<span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="c1"># year-month-day hour-minute-second.microsecond</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">If the incoming value does not match a format, it will be returned as-is</p>
</div>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'date'</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="DateField.year">
<code class="descname">year</code><a class="headerlink" href="#DateField.year" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>An expression suitable for extracting the year, for example to retrieve
all people born in 1980:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Person</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="n">dob</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">1983</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="DateField.month">
<code class="descname">month</code><a class="headerlink" href="#DateField.month" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Same as <a class="reference internal" href="#DateField.year" title="DateField.year"><code class="xref py py-attr docutils literal"><span class="pre">year</span></code></a>, except extract month.</p>
</dd></dl>

<dl class="attribute">
<dt id="DateField.day">
<code class="descname">day</code><a class="headerlink" href="#DateField.day" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Same as <a class="reference internal" href="#DateField.year" title="DateField.year"><code class="xref py py-attr docutils literal"><span class="pre">year</span></code></a>, except extract day.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="TimeField">
<em class="property">class </em><code class="descname">TimeField</code><a class="headerlink" href="#TimeField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: python <code class="docutils literal"><span class="pre">datetime.time</span></code> instances</p>
<p>Accepts a special parameter <code class="docutils literal"><span class="pre">formats</span></code>, which contains a list of formats
the time can be encoded with.  The default behavior is:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="s1">&#39;%H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="c1"># hour:minute:second.microsecond</span>
<span class="s1">&#39;%H:%M:%S&#39;</span> <span class="c1"># hour:minute:second</span>
<span class="s1">&#39;%H:%M&#39;</span> <span class="c1"># hour:minute</span>
<span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S.</span><span class="si">%f</span><span class="s1">&#39;</span> <span class="c1"># year-month-day hour-minute-second.microsecond</span>
<span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span> <span class="c1"># year-month-day hour-minute-second</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">If the incoming value does not match a format, it will be returned as-is</p>
</div>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'time'</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="TimeField.hour">
<code class="descname">hour</code><a class="headerlink" href="#TimeField.hour" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Extract the hour from a time, for example to retreive all events
occurring in the evening:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Event</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">hour</span> <span class="o">&gt;</span> <span class="mi">17</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="attribute">
<dt id="TimeField.minute">
<code class="descname">minute</code><a class="headerlink" href="#TimeField.minute" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Same as <a class="reference internal" href="#TimeField.hour" title="TimeField.hour"><code class="xref py py-attr docutils literal"><span class="pre">hour</span></code></a>, except extract minute.</p>
</dd></dl>

<dl class="attribute">
<dt id="TimeField.second">
<code class="descname">second</code><a class="headerlink" href="#TimeField.second" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Same as <a class="reference internal" href="#TimeField.hour" title="TimeField.hour"><code class="xref py py-attr docutils literal"><span class="pre">hour</span></code></a>, except extract second..</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="TimestampField">
<em class="property">class </em><code class="descname">TimestampField</code><a class="headerlink" href="#TimestampField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: python <code class="docutils literal"><span class="pre">datetime.datetime</span></code> instances (stored as integers)</p>
<p>Accepts a special parameter <code class="docutils literal"><span class="pre">resolution</span></code>, which is a power-of-10 up to
<code class="docutils literal"><span class="pre">10^6</span></code>. This allows sub-second precision while still using an
<a class="reference internal" href="#IntegerField" title="IntegerField"><code class="xref py py-class docutils literal"><span class="pre">IntegerField</span></code></a> for storage. Default is <code class="docutils literal"><span class="pre">1</span></code> (second precision).</p>
<p>Also accepts a boolean parameter <code class="docutils literal"><span class="pre">utc</span></code>, used to indicate whether the
timestamps should be UTC. Default is <code class="docutils literal"><span class="pre">False</span></code>.</p>
<p>Finally, the field <code class="docutils literal"><span class="pre">default</span></code> is the current timestamp. If you do not want
this behavior, then explicitly pass in <code class="docutils literal"><span class="pre">default=None</span></code>.</p>
</dd></dl>

<dl class="class">
<dt id="BooleanField">
<em class="property">class </em><code class="descname">BooleanField</code><a class="headerlink" href="#BooleanField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: <code class="docutils literal"><span class="pre">True</span></code> / <code class="docutils literal"><span class="pre">False</span></code></p>
<dl class="attribute">
<dt>
<code class="descname">db_field = 'bool'</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="BlobField">
<em class="property">class </em><code class="descname">BlobField</code><a class="headerlink" href="#BlobField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Store arbitrary binary data.</p>
</dd></dl>

<dl class="class">
<dt id="UUIDField">
<em class="property">class </em><code class="descname">UUIDField</code><a class="headerlink" href="#UUIDField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Store <code class="docutils literal"><span class="pre">UUID</span></code> values.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Currently this field is only supported by <a class="reference internal" href="#PostgresqlDatabase" title="PostgresqlDatabase"><code class="xref py py-class docutils literal"><span class="pre">PostgresqlDatabase</span></code></a>.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="BareField">
<em class="property">class </em><code class="descname">BareField</code><a class="headerlink" href="#BareField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Intended to be used only with SQLite. Since data-types are not enforced, you can declare fields without <em>any</em> data-type. It is also common for SQLite virtual tables to use meta-columns or untyped columns, so for those cases as well you may wish to use an untyped field.</p>
<p>Accepts a special <code class="docutils literal"><span class="pre">coerce</span></code> parameter, a function that takes a value coming from the database and converts it into the appropriate Python type.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Currently this field is only supported by <a class="reference internal" href="#SqliteDatabase" title="SqliteDatabase"><code class="xref py py-class docutils literal"><span class="pre">SqliteDatabase</span></code></a>.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="ForeignKeyField">
<em class="property">class </em><code class="descname">ForeignKeyField</code><span class="sig-paren">(</span><em>rel_model</em><span class="optional">[</span>, <em>related_name=None</em><span class="optional">[</span>, <em>on_delete=None</em><span class="optional">[</span>, <em>on_update=None</em><span class="optional">[</span>, <em>to_field=None</em><span class="optional">[</span>, <em>...</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#ForeignKeyField" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Stores: relationship to another model</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>rel_model</strong> – related <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> class or the string 『self』 if declaring a self-referential foreign key</li>
<li><strong>related_name</strong> (<em>string</em>) – attribute to expose on related model</li>
<li><strong>on_delete</strong> (<em>string</em>) – on delete behavior, e.g. <code class="docutils literal"><span class="pre">on_delete='CASCADE'</span></code>.</li>
<li><strong>on_update</strong> (<em>string</em>) – on update behavior.</li>
<li><strong>to_field</strong> – the field (or field name) on <code class="docutils literal"><span class="pre">rel_model</span></code> the foreign key
references. Defaults to the primary key field for <code class="docutils literal"><span class="pre">rel_model</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Tweet</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;tweets&#39;</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">TextField</span><span class="p">()</span>

<span class="c1"># &quot;user&quot; attribute</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">some_tweet</span><span class="o">.</span><span class="n">user</span>
<span class="o">&lt;</span><span class="n">User</span><span class="p">:</span> <span class="n">charlie</span><span class="o">&gt;</span>

<span class="c1"># &quot;tweets&quot; related name attribute</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">charlie</span><span class="o">.</span><span class="n">tweets</span><span class="p">:</span>
<span class="o">...</span>     <span class="k">print</span> <span class="n">tweet</span><span class="o">.</span><span class="n">content</span>
<span class="n">Some</span> <span class="n">tweet</span>
<span class="n">Another</span> <span class="n">tweet</span>
<span class="n">Yet</span> <span class="n">another</span> <span class="n">tweet</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Foreign keys do not have a particular <code class="docutils literal"><span class="pre">db_field</span></code> as they will
take their field type depending on the type of primary key on the model they are
related to.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">If you manually specify a <code class="docutils literal"><span class="pre">to_field</span></code>, that field must be either
a primary key or have a unique constraint.</p>
</div>
</dd></dl>

<dl class="class">
<dt id="CompositeKey">
<em class="property">class </em><code class="descname">CompositeKey</code><span class="sig-paren">(</span><em>*fields</em><span class="sig-paren">)</span><a class="headerlink" href="#CompositeKey" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Specify a composite primary key for a model.  Unlike the other fields, a
composite key is defined in the model’s <code class="docutils literal"><span class="pre">Meta</span></code> class after the fields
have been defined.  It takes as parameters the string names of the fields
to use as the primary key:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BlogTagThrough</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Blog</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;tags&#39;</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">Tag</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;blogs&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">primary_key</span> <span class="o">=</span> <span class="n">CompositeKey</span><span class="p">(</span><span class="s1">&#39;blog&#39;</span><span class="p">,</span> <span class="s1">&#39;tag&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="query-types">
<span id="id1"></span><h2>クエリの種類<a class="headerlink" href="#query-types" title="このヘッドラインへのパーマリンク">¶</a></h2>
<dl class="class">
<dt id="Query">
<em class="property">class </em><code class="descname">Query</code><a class="headerlink" href="#Query" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The parent class from which all other query classes are derived. While you
will not deal with <a class="reference internal" href="#Query" title="Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a> directly in your code, it implements some
methods that are common across all query types.</p>
<dl class="method">
<dt id="Query.where">
<code class="descname">where</code><span class="sig-paren">(</span><em>*expressions</em><span class="sig-paren">)</span><a class="headerlink" href="#Query.where" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>expressions</strong> – a list of one or more expressions</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">a <a class="reference internal" href="#Query" title="Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a> instance</td>
</tr>
</tbody>
</table>
<p>Example selection users where the username is equal to 『somebody』:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="s1">&#39;somebody&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Example selecting tweets made by users who are either editors or administrators:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">is_editor</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span> <span class="o">|</span>
    <span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">is_admin</span> <span class="o">==</span> <span class="bp">True</span><span class="p">))</span>
</pre></div>
</div>
<p>Example of deleting tweets by users who are no longer active:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">dq</span> <span class="o">=</span> <span class="n">DeleteQuery</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">Tweet</span><span class="o">.</span><span class="n">user</span> <span class="o">&lt;&lt;</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">False</span><span class="p">))</span>
<span class="n">dq</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c1"># perform the delete query</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last"><code class="xref py py-meth docutils literal"><span class="pre">where()</span></code> calls are chainable.  Multiple calls will
be 「AND」-ed together.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Query.join">
<code class="descname">join</code><span class="sig-paren">(</span><em>model</em>, <em>join_type=None</em>, <em>on=None</em><span class="sig-paren">)</span><a class="headerlink" href="#Query.join" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first simple">
<li><strong>model</strong> – the model to join on.  there must be a <a class="reference internal" href="#ForeignKeyField" title="ForeignKeyField"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyField</span></code></a> between
the current <code class="docutils literal"><span class="pre">query</span> <span class="pre">context</span></code> and the model passed in.</li>
<li><strong>join_type</strong> – allows the type of <code class="docutils literal"><span class="pre">JOIN</span></code> used to be specified explicitly,
one of <code class="docutils literal"><span class="pre">JOIN.INNER</span></code>, <code class="docutils literal"><span class="pre">JOIN.LEFT_OUTER</span></code>, <code class="docutils literal"><span class="pre">JOIN.FULL</span></code>, <code class="docutils literal"><span class="pre">JOIN.RIGHT_OUTER</span></code>,
or <code class="docutils literal"><span class="pre">JOIN.CROSS</span></code>.</li>
<li><strong>on</strong> – if multiple foreign keys exist between two models, this parameter
is the ForeignKeyField to join on.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><p class="first last">a <a class="reference internal" href="#Query" title="Query"><code class="xref py py-class docutils literal"><span class="pre">Query</span></code></a> instance</p>
</td>
</tr>
</tbody>
</table>
<p>Generate a <code class="docutils literal"><span class="pre">JOIN</span></code> clause from the current <code class="docutils literal"><span class="pre">query</span> <span class="pre">context</span></code> to the <code class="docutils literal"><span class="pre">model</span></code> passed
in, and establishes <code class="docutils literal"><span class="pre">model</span></code> as the new <code class="docutils literal"><span class="pre">query</span> <span class="pre">context</span></code>.</p>
<p>Example selecting tweets and joining on user in order to restrict to
only those tweets made by 「admin」 users:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">is_admin</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Example selecting users and joining on a particular foreign key field.
See the <a class="reference internal" href="example.html#example-app"><span class="std std-ref">example app</span></a> for a real-life usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Relationship</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="n">Relationship</span><span class="o">.</span><span class="n">to_user</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Query.switch">
<code class="descname">switch</code><span class="sig-paren">(</span><em>model</em><span class="sig-paren">)</span><a class="headerlink" href="#Query.switch" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>model</strong> – model to switch the <code class="docutils literal"><span class="pre">query</span> <span class="pre">context</span></code> to.</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">a clone of the query with a new query context</td>
</tr>
</tbody>
</table>
<p>Switches the <code class="docutils literal"><span class="pre">query</span> <span class="pre">context</span></code> to the given model.  Raises an exception if the
model has not been selected or joined on previously.  Useful for performing
multiple joins from a single table.</p>
<p>The following example selects from blog and joins on both entry and user:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Entry</span><span class="p">)</span><span class="o">.</span><span class="n">switch</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Query.alias">
<code class="descname">alias</code><span class="sig-paren">(</span><em>alias=None</em><span class="sig-paren">)</span><a class="headerlink" href="#Query.alias" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>alias</strong> (<em>str</em>) – A string to alias the result of this query</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">a Query instance</td>
</tr>
</tbody>
</table>
<p>Assign an alias to given query, which can be used as part of a subquery.</p>
</dd></dl>

<dl class="method">
<dt id="Query.sql">
<code class="descname">sql</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Query.sql" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">a 2-tuple containing the appropriate SQL query and a tuple of parameters</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Query.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Query.execute" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Execute the given query</p>
</dd></dl>

<dl class="method">
<dt id="Query.scalar">
<code class="descname">scalar</code><span class="sig-paren">(</span><span class="optional">[</span><em>as_tuple=False</em><span class="optional">[</span>, <em>convert=False</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Query.scalar" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first simple">
<li><strong>as_tuple</strong> (<em>bool</em>) – return the row as a tuple or a single value</li>
<li><strong>convert</strong> (<em>bool</em>) – attempt to coerce the selected value to the
appropriate data-type based on it’s associated Field type (assuming
one exists).</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><p class="first last">the resulting row, either as a single value or tuple</p>
</td>
</tr>
</tbody>
</table>
<p>Provide a way to retrieve single values from select queries, for instance
when performing an aggregation.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">PageView</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Distinct</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">url</span><span class="p">)))</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
<span class="go">100 # &lt;-- there are 100 distinct URLs in the pageview table</span>
</pre></div>
</div>
<p>This example illustrates the use of the <cite>convert</cite> argument. When using
a SQLite database, datetimes are stored as strings. To select the max
datetime, and have it <em>returned</em> as a datetime, we will specify
<code class="docutils literal"><span class="pre">convert=True</span></code>.</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">PageView</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">MAX</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span><span class="o">.</span><span class="n">scalar</span><span class="p">()</span>
<span class="go">&#39;2016-04-20 13:37:00.1234&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">PageView</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">MAX</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span><span class="o">.</span><span class="n">scalar</span><span class="p">(</span><span class="n">convert</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="go">datetime.datetime(2016, 4, 20, 13, 37, 0, 1234)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="SelectQuery">
<em class="property">class </em><code class="descname">SelectQuery</code><span class="sig-paren">(</span><em>model_class</em>, <em>*selection</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>By far the most complex of the query classes available in peewee. It supports
all clauses commonly associated with select queries.</p>
<p>Methods on the select query can be chained together.</p>
<p><code class="docutils literal"><span class="pre">SelectQuery</span></code> implements an <a class="reference internal" href="#SelectQuery.__iter__" title="SelectQuery.__iter__"><code class="xref py py-meth docutils literal"><span class="pre">__iter__()</span></code></a> method, allowing it to be iterated
to return model instances.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>model</strong> – a <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> class to perform query on</li>
<li><strong>selection</strong> – a list of models, fields, functions or expressions</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>If no selection is provided, it will default to all the fields of the given
model.</p>
<p>Example selecting some user instances from the database.  Only the <code class="docutils literal"><span class="pre">id</span></code>
and <code class="docutils literal"><span class="pre">username</span></code> columns are selected.  When iterated, will return instances
of the <code class="docutils literal"><span class="pre">User</span></code> model:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">sq</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
</pre></div>
</div>
<p>Example selecting users and additionally the number of tweets made by the user.
The <code class="docutils literal"><span class="pre">User</span></code> instances returned will have an additional attribute, 『count』, that
corresponds to the number of tweets made:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">SelectQuery</span><span class="p">(</span>
    <span class="n">User</span><span class="p">,</span> <span class="n">User</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="p">))</span>
</pre></div>
</div>
<dl class="method">
<dt id="SelectQuery.select">
<code class="descname">select</code><span class="sig-paren">(</span><em>*selection</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.select" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>selection</strong> – a list of expressions, which can be model classes or fields.
if left blank, will default to all the fields of the given model.</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Usually the selection will be specified when the instance is created.
This method simply exists for the case when you want to modify the
SELECT clause independent of instantiating a query.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.from_">
<code class="descname">from_</code><span class="sig-paren">(</span><em>*args</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.from_" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>args</strong> – one or more expressions, for example <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a>
or <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> instance(s). if left blank, will default
to the table of the given model.</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># rather than a join, select from both tables and join with where.</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">from_</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Blog</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Blog</span><span class="o">.</span><span class="n">user</span> <span class="o">==</span> <span class="n">User</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.group_by">
<code class="descname">group_by</code><span class="sig-paren">(</span><em>*clauses</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.group_by" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>clauses</strong> – a list of expressions, which can be model classes or individual field instances</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Group by one or more columns.  If a model class is provided, all the fields
on that model class will be used.</p>
<p>Example selecting users, joining on tweets, and grouping by the user so
a count of tweets can be calculated for each user:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.having">
<code class="descname">having</code><span class="sig-paren">(</span><em>*expressions</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.having" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>expressions</strong> – a list of one or more expressions</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Here is the above example selecting users and tweet counts, but restricting
the results to those users who have created 100 or more tweets:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">having</span><span class="p">(</span><span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.order_by">
<code class="descname">order_by</code><span class="sig-paren">(</span><em>*clauses</em><span class="optional">[</span>, <em>extend=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.order_by" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first simple">
<li><strong>clauses</strong> – a list of fields, calls to <code class="docutils literal"><span class="pre">field.[asc|desc]()</span></code> or
one or more expressions. If called without any arguments, any
pre-existing <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause will be removed.</li>
<li><strong>extend</strong> – When called with <code class="docutils literal"><span class="pre">extend=True</span></code>, Peewee will append any
to the pre-existing <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code> rather than overwriting it.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>Example of ordering users by username:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
</pre></div>
</div>
<p>Example of selecting tweets and ordering them first by user, then newest
first:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tweet</span>
         <span class="o">.</span><span class="n">select</span><span class="p">()</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span>
             <span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
             <span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="o">.</span><span class="n">desc</span><span class="p">()))</span>
</pre></div>
</div>
<p>You can also use <code class="docutils literal"><span class="pre">+</span></code> and <code class="docutils literal"><span class="pre">-</span></code> prefixes to indicate ascending or descending order if you prefer:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tweet</span>
         <span class="o">.</span><span class="n">select</span><span class="p">()</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span>
             <span class="o">+</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
             <span class="o">-</span><span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="p">))</span>
</pre></div>
</div>
<p>A more complex example ordering users by the number of tweets made (greatest
to least), then ordered by username in the event of a tie:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">tweet_ct</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="n">sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
    <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">tweet_ct</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
    <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">tweet_ct</span><span class="o">.</span><span class="n">desc</span><span class="p">(),</span> <span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</pre></div>
</div>
<p>Example of removing a pre-existing <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Query will be ordered by username.</span>
<span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>

<span class="c1"># Query will be returned in whatever order database chooses.</span>
<span class="n">unordered_users</span> <span class="o">=</span> <span class="n">users</span><span class="o">.</span><span class="n">order_by</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.window">
<code class="descname">window</code><span class="sig-paren">(</span><em>*windows</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.window" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>windows</strong> (<a class="reference internal" href="#Window" title="Window"><em>Window</em></a>) – One or more <a class="reference internal" href="#Window" title="Window"><code class="xref py py-class docutils literal"><span class="pre">Window</span></code></a> instances.</td>
</tr>
</tbody>
</table>
<p>Add one or more window definitions to this query.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="p">(</span><span class="n">partition_by</span><span class="o">=</span><span class="p">[</span><span class="n">fn</span><span class="o">.</span><span class="n">date_trunc</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)])</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">PageView</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span>
             <span class="n">PageView</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
             <span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
             <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">))</span>
         <span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.limit">
<code class="descname">limit</code><span class="sig-paren">(</span><em>num</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.limit" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>num</strong> (<em>int</em>) – limit results to <code class="docutils literal"><span class="pre">num</span></code> rows</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.offset">
<code class="descname">offset</code><span class="sig-paren">(</span><em>num</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.offset" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>num</strong> (<em>int</em>) – offset results by <code class="docutils literal"><span class="pre">num</span></code> rows</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.paginate">
<code class="descname">paginate</code><span class="sig-paren">(</span><em>page_num</em>, <em>paginate_by=20</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.paginate" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first simple">
<li><strong>page_num</strong> – a 1-based page number to use for paginating results</li>
<li><strong>paginate_by</strong> – number of results to return per-page</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>Shorthand for applying a <code class="docutils literal"><span class="pre">LIMIT</span></code> and <code class="docutils literal"><span class="pre">OFFSET</span></code> to the query.</p>
<p>Page indices are <strong>1-based</strong>, so page 1 is the first page.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>  <span class="c1"># get users 41-60</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.distinct">
<code class="descname">distinct</code><span class="sig-paren">(</span><span class="optional">[</span><em>is_distinct=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.distinct" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>is_distinct</strong> – See notes.</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Indicates that this query should only return distinct rows. Results in a
<code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">DISTINCT</span></code> query.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>The value for <code class="docutils literal"><span class="pre">is_distinct</span></code> should either be a boolean, in which
case the query will (or won’t) be <cite>DISTINCT</cite>.</p>
<p class="last">You can specify a list of one or more expressions to generate a
<code class="docutils literal"><span class="pre">DISTINCT</span> <span class="pre">ON</span></code> query, e.g. <code class="docutils literal"><span class="pre">.distinct([Model.col1,</span> <span class="pre">Model.col2])</span></code>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.for_update">
<code class="descname">for_update</code><span class="sig-paren">(</span><span class="optional">[</span><em>for_update=True</em><span class="optional">[</span>, <em>nowait=False</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.for_update" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Indicate that this query should lock rows for update.  If <code class="docutils literal"><span class="pre">nowait</span></code> is
<code class="docutils literal"><span class="pre">True</span></code> then the database will raise an <code class="docutils literal"><span class="pre">OperationalError</span></code> if it
cannot obtain the lock.</p>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.with_lock">
<code class="descname">with_lock</code><span class="sig-paren">(</span><span class="optional">[</span><em>lock_type='UPDATE'</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.with_lock" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Indicates that this query shoudl lock rows. A more generic version of
the <a class="reference internal" href="#SelectQuery.for_update" title="SelectQuery.for_update"><code class="xref py py-meth docutils literal"><span class="pre">for_update()</span></code></a> method.</p>
<p>例:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># SELECT * FROM some_model FOR KEY SHARE NOWAIT;</span>
<span class="n">SomeModel</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">with_lock</span><span class="p">(</span><span class="s1">&#39;KEY SHARE NOWAIT&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">You do not need to include the word <em>FOR</em>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.naive">
<code class="descname">naive</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.naive" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Flag this query indicating it should only attempt to reconstruct a single model
instance for every row returned by the cursor.  If multiple tables were queried,
the columns returned are patched directly onto the single model instance.</p>
<p>Generally this method is useful for speeding up the time needed to construct
model instances given a database cursor.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">this can provide a significant speed improvement when doing simple
iteration over a large result set.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.iterator">
<code class="descname">iterator</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.iterator" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><code class="docutils literal"><span class="pre">iterable</span></code></td>
</tr>
</tbody>
</table>
<p>By default peewee will cache rows returned by the cursor.  This is to
prevent things like multiple iterations, slicing and indexing from
triggering extra queries.  When you are iterating over a large number
of rows, however, this cache can take up a lot of memory. Using <code class="docutils literal"><span class="pre">iterator()</span></code>
will save memory by not storing all the returned model instances.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># iterate over large number of rows.</span>
<span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">Stats</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">iterator</span><span class="p">():</span>
    <span class="c1"># do something.</span>
    <span class="k">pass</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.tuples">
<code class="descname">tuples</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.tuples" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Flag this query indicating it should simply return raw tuples from the cursor.
This method is useful when you either do not want or do not need full model
instances.</p>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.dicts">
<code class="descname">dicts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.dicts" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Flag this query indicating it should simply return dictionaries from the cursor.
This method is useful when you either do not want or do not need full model
instances.</p>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.aggregate_rows">
<code class="descname">aggregate_rows</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.aggregate_rows" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>This method provides one way to avoid the <strong>N+1</strong> query problem.</p>
<p>Consider a webpage where you wish to display a list of users and all of their
associated tweets. You could approach this problem by listing the users, then
for each user executing a separate query to retrieve their tweets. This is the
<strong>N+1</strong> behavior, because the number of queries varies depending on the number
of users. Conventional wisdom is that it is preferable to execute fewer queries.
Peewee provides several ways to avoid this problem.</p>
<p>You can use the <a class="reference internal" href="#prefetch" title="prefetch"><code class="xref py py-func docutils literal"><span class="pre">prefetch()</span></code></a> helper, which uses <code class="docutils literal"><span class="pre">IN</span></code> clauses to retrieve
the tweets for the listed users.</p>
<p>Another method is to select both the user and the tweet data in a single query,
then de-dupe the users, aggregating the tweets in the process.</p>
<p>The raw column data might appear like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># user.id, user.username, tweet.id, tweet.user_id, tweet.message</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span>        <span class="s1">&#39;charlie&#39;</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>             <span class="s1">&#39;hello&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span>        <span class="s1">&#39;charlie&#39;</span><span class="p">,</span>     <span class="mi">2</span><span class="p">,</span>        <span class="mi">1</span><span class="p">,</span>             <span class="s1">&#39;goodbye&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span>        <span class="s1">&#39;no-tweets&#39;</span><span class="p">,</span>   <span class="n">NULL</span><span class="p">,</span>     <span class="n">NULL</span><span class="p">,</span>          <span class="n">NULL</span><span class="p">],</span>
<span class="p">[</span><span class="mi">3</span><span class="p">,</span>        <span class="s1">&#39;huey&#39;</span><span class="p">,</span>        <span class="mi">3</span><span class="p">,</span>        <span class="mi">3</span><span class="p">,</span>             <span class="s1">&#39;meow&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="mi">3</span><span class="p">,</span>        <span class="s1">&#39;huey&#39;</span><span class="p">,</span>        <span class="mi">4</span><span class="p">,</span>        <span class="mi">3</span><span class="p">,</span>             <span class="s1">&#39;purr&#39;</span><span class="p">],</span>
<span class="p">[</span><span class="mi">3</span><span class="p">,</span>        <span class="s1">&#39;huey&#39;</span><span class="p">,</span>        <span class="mi">5</span><span class="p">,</span>        <span class="mi">3</span><span class="p">,</span>             <span class="s1">&#39;hiss&#39;</span><span class="p">],</span>
</pre></div>
</div>
<p>We can infer from the <code class="docutils literal"><span class="pre">JOIN</span></code> clause that the user data will be duplicated, and
therefore by de-duping the users, we can collect their tweets in one go and iterate
over the users and tweets transparently.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">Tweet</span><span class="p">)</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">JOIN</span><span class="o">.</span><span class="n">LEFT_OUTER</span><span class="p">)</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
         <span class="o">.</span><span class="n">aggregate_rows</span><span class="p">())</span>  <span class="c1"># .aggregate_rows() tells peewee to de-dupe the rows.</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
    <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">tweets</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;  &#39;</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">message</span>

<span class="c1"># Producing the following output:</span>
<span class="n">charlie</span>
   <span class="n">hello</span>
   <span class="n">goodbye</span>
<span class="n">huey</span>
   <span class="n">meow</span>
   <span class="n">purr</span>
   <span class="n">hiss</span>
<span class="n">no</span><span class="o">-</span><span class="n">tweets</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">Be sure that you specify an <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code> clause that ensures duplicated data
will appear in consecutive rows.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">You can specify arbitrarily complex joins, though for more complex queries
it may be more efficient to use <a class="reference internal" href="#prefetch" title="prefetch"><code class="xref py py-func docutils literal"><span class="pre">prefetch()</span></code></a>. In short, try both and
see what works best for your data-set.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">For more information, see the <a class="reference internal" href="querying.html#nplusone"><span class="std std-ref">N+1クエリを避ける</span></a> document and the <a class="reference internal" href="querying.html#aggregate-rows"><span class="std std-ref">Using aggregate_rows</span></a> sub-section.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.annotate">
<code class="descname">annotate</code><span class="sig-paren">(</span><em>related_model</em>, <em>aggregation=None</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.annotate" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first simple">
<li><strong>related_model</strong> – related <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> on which to perform aggregation,
must be linked by <a class="reference internal" href="#ForeignKeyField" title="ForeignKeyField"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyField</span></code></a>.</li>
<li><strong>aggregation</strong> – the type of aggregation to use, e.g. <code class="docutils literal"><span class="pre">fn.Count(Tweet.id).alias('count')</span></code></li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a></p>
</td>
</tr>
</tbody>
</table>
<p>Annotate a query with an aggregation performed on a related model, for example,
「get a list of users with the number of tweets for each」:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
</pre></div>
</div>
<p>If <code class="docutils literal"><span class="pre">aggregation</span></code> is None, it will default to <code class="docutils literal"><span class="pre">fn.Count(related_model.id).alias('count')</span></code>
but can be anything:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">user_latest</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Max</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">created_date</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;latest&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>If the <code class="docutils literal"><span class="pre">ForeignKeyField</span></code> is <code class="docutils literal"><span class="pre">nullable</span></code>, then a <code class="docutils literal"><span class="pre">LEFT</span> <span class="pre">OUTER</span></code> join
may need to be used:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
         <span class="o">.</span><span class="n">select</span><span class="p">()</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">JOIN</span><span class="o">.</span><span class="n">LEFT_OUTER</span><span class="p">)</span>
         <span class="o">.</span><span class="n">switch</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>  <span class="c1"># Switch query context back to `User`.</span>
         <span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">Tweet</span><span class="p">))</span>
</pre></div>
</div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.aggregate">
<code class="descname">aggregate</code><span class="sig-paren">(</span><em>aggregation</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.aggregate" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>aggregation</strong> – a function specifying what aggregation to perform, for
example <code class="docutils literal"><span class="pre">fn.Max(Tweet.created_date)</span></code>.</td>
</tr>
</tbody>
</table>
<p>Method to look at an aggregate of rows using a given function and
return a scalar value, such as the count of all rows or the average
value of a particular column.</p>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.count">
<code class="descname">count</code><span class="sig-paren">(</span><span class="optional">[</span><em>clear_limit=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.count" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>clear_limit</strong> (<em>bool</em>) – Remove any limit or offset clauses from the query before counting.</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">an integer representing the number of rows in the current query</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">If the query has a GROUP BY, DISTINCT, LIMIT, or OFFSET
clause, then the <a class="reference internal" href="#SelectQuery.wrapped_count" title="SelectQuery.wrapped_count"><code class="xref py py-meth docutils literal"><span class="pre">wrapped_count()</span></code></a> method
will be used instead.</p>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sq</span> <span class="o">=</span> <span class="n">SelectQuery</span><span class="p">(</span><span class="n">Tweet</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sq</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">45  # number of tweets</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deleted_tweets</span> <span class="o">=</span> <span class="n">sq</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">DELETED</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">deleted_tweets</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="go">3  # number of tweets that are marked as deleted</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.wrapped_count">
<code class="descname">wrapped_count</code><span class="sig-paren">(</span><span class="optional">[</span><em>clear_limit=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.wrapped_count" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>clear_limit</strong> (<em>bool</em>) – Remove any limit or offset clauses from the query before counting.</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">an integer representing the number of rows in the current query</td>
</tr>
</tbody>
</table>
<p>Wrap the count query in a subquery.  Additional overhead but will give
correct counts when performing <code class="docutils literal"><span class="pre">DISTINCT</span></code> queries or those with <code class="docutils literal"><span class="pre">GROUP</span> <span class="pre">BY</span></code>
clauses.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last"><a class="reference internal" href="#SelectQuery.count" title="SelectQuery.count"><code class="xref py py-meth docutils literal"><span class="pre">count()</span></code></a> will automatically default to <a class="reference internal" href="#SelectQuery.wrapped_count" title="SelectQuery.wrapped_count"><code class="xref py py-meth docutils literal"><span class="pre">wrapped_count()</span></code></a>
in the event the query is distinct or has a grouping.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.exists">
<code class="descname">exists</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.exists" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">boolean whether the current query will return any rows.  uses an
optimized lookup, so use this rather than <a class="reference internal" href="#SelectQuery.get" title="SelectQuery.get"><code class="xref py py-meth docutils literal"><span class="pre">get()</span></code></a>.</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">sq</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="k">if</span> <span class="n">sq</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">authenticated</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.get">
<code class="descname">get</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.get" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> instance or raises <code class="docutils literal"><span class="pre">DoesNotExist</span></code> exception</td>
</tr>
</tbody>
</table>
<p>Get a single row from the database that matches the given query.  Raises a
<code class="docutils literal"><span class="pre">&lt;model-class&gt;.DoesNotExist</span></code> if no rows are returned:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">active</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">active</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="k">except</span> <span class="n">User</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
    <span class="n">user</span> <span class="o">=</span> <span class="bp">None</span>
</pre></div>
</div>
<p>This method is also exposed via the <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> api, in which case it
accepts arguments that are translated to the where clause:</p>
<blockquote>
<div>user = User.get(User.active == True, User.username == username)</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.first">
<code class="descname">first</code><span class="sig-paren">(</span><span class="optional">[</span><em>n=1</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.first" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>n</strong> (<em>int</em>) – Return the first <em>n</em> query results after applying a limit
of <code class="docutils literal"><span class="pre">n</span></code> records.</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> instance, list or <code class="docutils literal"><span class="pre">None</span></code> if no results</td>
</tr>
</tbody>
</table>
<p>Fetch the first <em>n</em> rows from a query. Behind-the-scenes, a <code class="docutils literal"><span class="pre">LIMIT</span> <span class="pre">n</span></code>
is applied. The results of the query are then cached on the query
result wrapper so subsequent calls to <a class="reference internal" href="#SelectQuery.first" title="SelectQuery.first"><code class="xref py py-meth docutils literal"><span class="pre">first()</span></code></a>
will not cause multiple queries.</p>
<p>If only one row is requested (default behavior), then the return-type
will be either a model instance or <code class="docutils literal"><span class="pre">None</span></code>.</p>
<p>If multiple rows are requested, the return type will either be a list
of one to n model instances, or <code class="docutils literal"><span class="pre">None</span></code> if no results are found.</p>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.peek">
<code class="descname">peek</code><span class="sig-paren">(</span><span class="optional">[</span><em>n=1</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.peek" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>n</strong> (<em>int</em>) – Return the first <em>n</em> query results.</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> instance, list or <code class="docutils literal"><span class="pre">None</span></code> if no results</td>
</tr>
</tbody>
</table>
<p>Fetch the first <em>n</em> rows from a query. No <code class="docutils literal"><span class="pre">LIMIT</span></code> is applied to the
query, so the <a class="reference internal" href="#SelectQuery.peek" title="SelectQuery.peek"><code class="xref py py-meth docutils literal"><span class="pre">peek()</span></code></a> has slightly different
semantics from <a class="reference internal" href="#SelectQuery.first" title="SelectQuery.first"><code class="xref py py-meth docutils literal"><span class="pre">first()</span></code></a>, which ensures no more
than <em>n</em> rows are requested. The <code class="docutils literal"><span class="pre">peek</span></code> method, on the other hand,
retains the ability to fetch the entire result set withouth issuing
additional queries.</p>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.execute" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><code class="xref py py-class docutils literal"><span class="pre">QueryResultWrapper</span></code></td>
</tr>
</tbody>
</table>
<p>Executes the query and returns a <code class="xref py py-class docutils literal"><span class="pre">QueryResultWrapper</span></code> for iterating over
the result set.  The results are managed internally by the query and whenever
a clause is added that would possibly alter the result set, the query is
marked for re-execution.</p>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.__iter__">
<code class="descname">__iter__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.__iter__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Executes the query and returns populated model instances:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">):</span>
    <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.__len__">
<code class="descname">__len__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.__len__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Return the number of items in the result set of this query. If all you need is the count of items and do not intend to do anything with the results, call <a class="reference internal" href="#SelectQuery.count" title="SelectQuery.count"><code class="xref py py-meth docutils literal"><span class="pre">count()</span></code></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">The <code class="docutils literal"><span class="pre">SELECT</span></code> query will be executed and the result set will be loaded.
If you want to obtain the number of results without also loading
the query, use <a class="reference internal" href="#SelectQuery.count" title="SelectQuery.count"><code class="xref py py-meth docutils literal"><span class="pre">count()</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.__getitem__">
<code class="descname">__getitem__</code><span class="sig-paren">(</span><em>value</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.__getitem__" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>value</strong> – Either an index or a <code class="docutils literal"><span class="pre">slice</span></code> object.</td>
</tr>
</tbody>
</table>
<p>Return the model instance(s) at the requested indices. To get the first
model, for instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
<span class="n">first_user</span> <span class="o">=</span> <span class="n">query</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">first_five</span> <span class="o">=</span> <span class="n">query</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.__or__">
<code class="descname">__or__</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.__or__" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>rhs</strong> – Either a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> or a <a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
</tbody>
</table>
<p>Create a <code class="docutils literal"><span class="pre">UNION</span></code> query with the right-hand object. The result will contain all values from both the left and right queries.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">customers</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;KS&#39;</span><span class="p">)</span>
<span class="n">stores</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;KS&#39;</span><span class="p">)</span>

<span class="c1"># Get all cities in kansas where we have either a customer or a store.</span>
<span class="n">all_cities</span> <span class="o">=</span> <span class="p">(</span><span class="n">customers</span> <span class="o">|</span> <span class="n">stores</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">SQL</span><span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">SQLite does not allow <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code> or <code class="docutils literal"><span class="pre">LIMIT</span></code> clauses on the components of a compound query, however SQLite does allow these clauses on the final, compound result. This applies to <code class="docutils literal"><span class="pre">UNION</span> <span class="pre">(ALL)</span></code>, <code class="docutils literal"><span class="pre">INTERSECT</span></code>, and <code class="docutils literal"><span class="pre">EXCEPT</span></code>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.__and__">
<code class="descname">__and__</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.__and__" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>rhs</strong> – Either a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> or a <a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
</tbody>
</table>
<p>Create an <code class="docutils literal"><span class="pre">INTERSECT</span></code> query. The result will contain values that are in
both the left and right queries.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">customers</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;KS&#39;</span><span class="p">)</span>
<span class="n">stores</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;KS&#39;</span><span class="p">)</span>

<span class="c1"># Get all cities in kanasas where we have both customers and stores.</span>
<span class="n">cities</span> <span class="o">=</span> <span class="p">(</span><span class="n">customers</span> <span class="o">&amp;</span> <span class="n">stores</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">SQL</span><span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.__sub__">
<code class="descname">__sub__</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.__sub__" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>rhs</strong> – Either a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> or a <a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
</tbody>
</table>
<p>Create an <code class="docutils literal"><span class="pre">EXCEPT</span></code> query. The result will contain values that are in
the left-hand query but not in the right-hand query.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">customers</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;KS&#39;</span><span class="p">)</span>
<span class="n">stores</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;KS&#39;</span><span class="p">)</span>

<span class="c1"># Get all cities in kanasas where we have customers but no stores.</span>
<span class="n">cities</span> <span class="o">=</span> <span class="p">(</span><span class="n">customers</span> <span class="o">-</span> <span class="n">stores</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">SQL</span><span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="SelectQuery.__xor__">
<code class="descname">__xor__</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#SelectQuery.__xor__" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>rhs</strong> – Either a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> or a <a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#CompoundSelect" title="CompoundSelect"><code class="xref py py-class docutils literal"><span class="pre">CompoundSelect</span></code></a></td>
</tr>
</tbody>
</table>
<p>Create an symmetric difference query. The result will contain values
that are in either the left-hand query or the right-hand query, but not
both.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">customers</span> <span class="o">=</span> <span class="n">Customer</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Customer</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;KS&#39;</span><span class="p">)</span>
<span class="n">stores</span> <span class="o">=</span> <span class="n">Store</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">city</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Store</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="s1">&#39;KS&#39;</span><span class="p">)</span>

<span class="c1"># Get all cities in kanasas where we have either customers with no</span>
<span class="c1"># store, or a store with no customers.</span>
<span class="n">cities</span> <span class="o">=</span> <span class="p">(</span><span class="n">customers</span> <span class="o">^</span> <span class="n">stores</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">SQL</span><span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="UpdateQuery">
<em class="property">class </em><code class="descname">UpdateQuery</code><span class="sig-paren">(</span><em>model_class</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#UpdateQuery" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>model</strong> – <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> class on which to perform update</li>
<li><strong>kwargs</strong> – mapping of field/value pairs containing columns and values to update</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Example in which users are marked inactive if their registration expired:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">uq</span> <span class="o">=</span> <span class="n">UpdateQuery</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">registration_expired</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">uq</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c1"># Perform the actual update</span>
</pre></div>
</div>
<p>Example of an atomic update:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">atomic_update</span> <span class="o">=</span> <span class="n">UpdateQuery</span><span class="p">(</span><span class="n">PageCount</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">PageCount</span><span class="o">.</span><span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">PageCount</span><span class="o">.</span><span class="n">url</span> <span class="o">==</span> <span class="n">url</span><span class="p">)</span>
<span class="n">atomic_update</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c1"># will perform the actual update</span>
</pre></div>
</div>
<dl class="method">
<dt id="UpdateQuery.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#UpdateQuery.execute" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">Number of rows updated</td>
</tr>
</tbody>
</table>
<p>Performs the query</p>
</dd></dl>

<dl class="method">
<dt id="UpdateQuery.returning">
<code class="descname">returning</code><span class="sig-paren">(</span><em>*returning</em><span class="sig-paren">)</span><a class="headerlink" href="#UpdateQuery.returning" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>returning</strong> – A list of model classes, field instances, functions
or expressions. If no argument is provided, all columns for the given model
will be selected. To clear any existing values, pass in <code class="docutils literal"><span class="pre">None</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">a <a class="reference internal" href="#UpdateQuery" title="UpdateQuery"><code class="xref py py-class docutils literal"><span class="pre">UpdateQuery</span></code></a> for the given <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a>.</td>
</tr>
</tbody>
</table>
<p>Add a <code class="docutils literal"><span class="pre">RETURNING</span></code> clause to the query, which will cause the <code class="docutils literal"><span class="pre">UPDATE</span></code> to compute return values based on each row that was actually updated.</p>
<p>When the query is executed, rather than returning the number of rows updated, an iterator will be returned that yields the updated objects.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Currently only <a class="reference internal" href="#PostgresqlDatabase" title="PostgresqlDatabase"><code class="xref py py-class docutils literal"><span class="pre">PostgresqlDatabase</span></code></a> supports this feature.</p>
</div>
<p>例:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Disable all users whose registration expired, and return the user</span>
<span class="c1"># objects that were updated.</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
         <span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
         <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">registration_expired</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
         <span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">User</span><span class="p">))</span>

<span class="c1"># We can iterate over the users that were updated.</span>
<span class="k">for</span> <span class="n">updated_user</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">execute</span><span class="p">():</span>
    <span class="n">send_activation_email</span><span class="p">(</span><span class="n">updated_user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information, check out <a class="reference internal" href="querying.html#returning-clause"><span class="std std-ref">the RETURNING clause docs</span></a>.</p>
</dd></dl>

<dl class="method">
<dt id="UpdateQuery.tuples">
<code class="descname">tuples</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#UpdateQuery.tuples" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#UpdateQuery" title="UpdateQuery"><code class="xref py py-class docutils literal"><span class="pre">UpdateQuery</span></code></a></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">This method should only be used in conjunction with a call to <a class="reference internal" href="#UpdateQuery.returning" title="UpdateQuery.returning"><code class="xref py py-meth docutils literal"><span class="pre">returning()</span></code></a>.</p>
</div>
<p>When the updated results are returned, they will be returned as row tuples.</p>
</dd></dl>

<dl class="method">
<dt id="UpdateQuery.dicts">
<code class="descname">dicts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#UpdateQuery.dicts" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#UpdateQuery" title="UpdateQuery"><code class="xref py py-class docutils literal"><span class="pre">UpdateQuery</span></code></a></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">This method should only be used in conjunction with a call to <a class="reference internal" href="#UpdateQuery.returning" title="UpdateQuery.returning"><code class="xref py py-meth docutils literal"><span class="pre">returning()</span></code></a>.</p>
</div>
<p>When the updated results are returned, they will be returned as dictionaries mapping column to value.</p>
</dd></dl>

<dl class="method">
<dt id="UpdateQuery.on_conflict">
<code class="descname">on_conflict</code><span class="sig-paren">(</span><span class="optional">[</span><em>action=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#UpdateQuery.on_conflict" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Add a SQL <code class="docutils literal"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> clause with the specified action to the given <code class="docutils literal"><span class="pre">UPDATE</span></code> query. <a class="reference external" href="https://www.sqlite.org/lang_conflict.html">Valid actions</a> are:</p>
<ul class="simple">
<li>ROLLBACK</li>
<li>ABORT</li>
<li>FAIL</li>
<li>IGNORE</li>
<li>REPLACE</li>
</ul>
<p>Specifying <code class="docutils literal"><span class="pre">None</span></code> for the action will execute a normal <code class="docutils literal"><span class="pre">UPDATE</span></code> query.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">This feature is only available on SQLite databases.</p>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="InsertQuery">
<em class="property">class </em><code class="descname">InsertQuery</code><span class="sig-paren">(</span><em>model_class</em><span class="optional">[</span>, <em>field_dict=None</em><span class="optional">[</span>, <em>rows=None</em><span class="optional">[</span>, <em>fields=None</em><span class="optional">[</span>, <em>query=None</em><span class="optional">[</span>, <em>validate_fields=False</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#InsertQuery" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Creates an <code class="docutils literal"><span class="pre">InsertQuery</span></code> instance for the given model.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>field_dict</strong> (<em>dict</em>) – A mapping of either field or field-name to value.</li>
<li><strong>rows</strong> (<em>iterable</em>) – An iterable of dictionaries containing a mapping of
field or field-name to value.</li>
<li><strong>fields</strong> (<em>list</em>) – A list of field objects to insert data into (only used in combination with the <code class="docutils literal"><span class="pre">query</span></code> parameter).</li>
<li><strong>query</strong> – A <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> to use as the source of data.</li>
<li><strong>validate_fields</strong> (<em>bool</em>) – Check that every column referenced in the insert query has a corresponding field on the model. If validation is enabled and then fails, a <code class="docutils literal"><span class="pre">KeyError</span></code> is raised.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Basic example:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iq</span> <span class="o">=</span> <span class="n">InsertQuery</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iq</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>  <span class="c1"># insert new row and return primary key</span>
<span class="go">2L</span>
</pre></div>
</div>
<p>Example inserting multiple rows:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">users</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;peewee&#39;</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;huey&#39;</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}]</span>
<span class="n">iq</span> <span class="o">=</span> <span class="n">InsertQuery</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="n">users</span><span class="p">)</span>
<span class="n">iq</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<p>Example inserting using a query as the data source:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">COUNT</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">JOIN</span><span class="o">.</span><span class="n">LEFT_OUTER</span><span class="p">)</span>
         <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
<span class="n">iq</span> <span class="o">=</span> <span class="n">InsertQuery</span><span class="p">(</span>
    <span class="n">UserTweetDenorm</span><span class="p">,</span>
    <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="n">UserTweetDenorm</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">UserTweetDenorm</span><span class="o">.</span><span class="n">num_tweets</span><span class="p">],</span>
    <span class="n">query</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
<span class="n">iq</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
</pre></div>
</div>
<dl class="method">
<dt id="InsertQuery.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#InsertQuery.execute" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">primary key of the new row</td>
</tr>
</tbody>
</table>
<p>Performs the query</p>
</dd></dl>

<dl class="method">
<dt id="InsertQuery.upsert">
<code class="descname">upsert</code><span class="sig-paren">(</span><span class="optional">[</span><em>upsert=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#InsertQuery.upsert" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Perform an <em>INSERT OR REPLACE</em> query with SQLite. MySQL databases will issue a <em>REPLACE</em> query. Currently this feature is not supported for Postgres databases, but the 9.5 syntax will be added soon.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">This feature is only available on SQLite and MySQL databases.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="InsertQuery.on_conflict">
<code class="descname">on_conflict</code><span class="sig-paren">(</span><span class="optional">[</span><em>action=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#InsertQuery.on_conflict" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Add a SQL <code class="docutils literal"><span class="pre">ON</span> <span class="pre">CONFLICT</span></code> clause with the specified action to the given <code class="docutils literal"><span class="pre">INSERT</span></code> query. Specifying <code class="docutils literal"><span class="pre">REPLACE</span></code> is equivalent to using the <a class="reference internal" href="#InsertQuery.upsert" title="InsertQuery.upsert"><code class="xref py py-meth docutils literal"><span class="pre">upsert()</span></code></a> method. <a class="reference external" href="https://www.sqlite.org/lang_conflict.html">Valid actions</a> are:</p>
<ul class="simple">
<li>ROLLBACK</li>
<li>ABORT</li>
<li>FAIL</li>
<li>IGNORE</li>
<li>REPLACE</li>
</ul>
<p>Specifying <code class="docutils literal"><span class="pre">None</span></code> for the action will execute a normal <code class="docutils literal"><span class="pre">INSERT</span></code> query.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">This feature is only available on SQLite databases.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="InsertQuery.return_id_list">
<code class="descname">return_id_list</code><span class="sig-paren">(</span><span class="optional">[</span><em>return_id_list=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#InsertQuery.return_id_list" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>By default, when doing bulk INSERTs, peewee will not return the list of generated primary keys. However, if the database supports returning primary keys via <code class="docutils literal"><span class="pre">INSERT</span> <span class="pre">...</span> <span class="pre">RETURNING</span></code>, this method instructs peewee to return the generated list of IDs.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Currently only PostgreSQL supports this behavior. While other databases support bulk inserts, they will simply return <code class="docutils literal"><span class="pre">True</span></code> instead.</p>
</div>
<p>例:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">usernames</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">username</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;charlie&#39;</span><span class="p">,</span> <span class="s1">&#39;huey&#39;</span><span class="p">,</span> <span class="s1">&#39;mickey&#39;</span><span class="p">]]</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">usernames</span><span class="p">)</span><span class="o">.</span><span class="n">return_id_list</span><span class="p">()</span>
<span class="n">user_ids</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="k">print</span> <span class="n">user_ids</span>
<span class="c1"># prints something like [1, 2, 3]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="InsertQuery.returning">
<code class="descname">returning</code><span class="sig-paren">(</span><em>*returning</em><span class="sig-paren">)</span><a class="headerlink" href="#InsertQuery.returning" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>returning</strong> – A list of model classes, field instances, functions
or expressions. If no argument is provided, all columns for the given model
will be selected. To clear any existing values, pass in <code class="docutils literal"><span class="pre">None</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">a <a class="reference internal" href="#InsertQuery" title="InsertQuery"><code class="xref py py-class docutils literal"><span class="pre">InsertQuery</span></code></a> for the given <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a>.</td>
</tr>
</tbody>
</table>
<p>Add a <code class="docutils literal"><span class="pre">RETURNING</span></code> clause to the query, which will cause the <code class="docutils literal"><span class="pre">INSERT</span></code> to compute return values based on each row that was inserted.</p>
<p>When the query is executed, rather than returning the primary key of the new row(s), an iterator will be returned that yields the inserted objects.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Currently only <a class="reference internal" href="#PostgresqlDatabase" title="PostgresqlDatabase"><code class="xref py py-class docutils literal"><span class="pre">PostgresqlDatabase</span></code></a> supports this feature.</p>
</div>
<p>例:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Create some users, retrieving the list of IDs assigned to them.</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
         <span class="o">.</span><span class="n">insert_many</span><span class="p">(</span><span class="n">list_of_user_data</span><span class="p">)</span>
         <span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">User</span><span class="p">))</span>

<span class="c1"># We can iterate over the users that were created.</span>
<span class="k">for</span> <span class="n">new_user</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">execute</span><span class="p">():</span>
    <span class="c1"># Do something with the new user&#39;s ID...</span>
    <span class="n">do_something</span><span class="p">(</span><span class="n">new_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information, check out <a class="reference internal" href="querying.html#returning-clause"><span class="std std-ref">the RETURNING clause docs</span></a>.</p>
</dd></dl>

<dl class="method">
<dt id="InsertQuery.tuples">
<code class="descname">tuples</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#InsertQuery.tuples" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#InsertQuery" title="InsertQuery"><code class="xref py py-class docutils literal"><span class="pre">InsertQuery</span></code></a></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">This method should only be used in conjunction with a call to <a class="reference internal" href="#InsertQuery.returning" title="InsertQuery.returning"><code class="xref py py-meth docutils literal"><span class="pre">returning()</span></code></a>.</p>
</div>
<p>When the inserted results are returned, they will be returned as row tuples.</p>
</dd></dl>

<dl class="method">
<dt id="InsertQuery.dicts">
<code class="descname">dicts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#InsertQuery.dicts" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#InsertQuery" title="InsertQuery"><code class="xref py py-class docutils literal"><span class="pre">InsertQuery</span></code></a></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">This method should only be used in conjunction with a call to <a class="reference internal" href="#InsertQuery.returning" title="InsertQuery.returning"><code class="xref py py-meth docutils literal"><span class="pre">returning()</span></code></a>.</p>
</div>
<p>When the inserted results are returned, they will be returned as dictionaries mapping column to value.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="DeleteQuery">
<em class="property">class </em><code class="descname">DeleteQuery</code><span class="sig-paren">(</span><em>model_class</em><span class="sig-paren">)</span><a class="headerlink" href="#DeleteQuery" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Creates a <em>DELETE</em> query for the given model.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">DeleteQuery will <em>not</em> traverse foreign keys or ensure that constraints
are obeyed, so use it with care.</p>
</div>
<p>Example deleting users whose account is inactive:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">dq</span> <span class="o">=</span> <span class="n">DeleteQuery</span><span class="p">(</span><span class="n">User</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="DeleteQuery.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#DeleteQuery.execute" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">Number of rows deleted</td>
</tr>
</tbody>
</table>
<p>Performs the query</p>
</dd></dl>

<dl class="method">
<dt id="DeleteQuery.returning">
<code class="descname">returning</code><span class="sig-paren">(</span><em>*returning</em><span class="sig-paren">)</span><a class="headerlink" href="#DeleteQuery.returning" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>returning</strong> – A list of model classes, field instances, functions
or expressions. If no argument is provided, all columns for the given model
will be selected. To clear any existing values, pass in <code class="docutils literal"><span class="pre">None</span></code>.</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body">a <a class="reference internal" href="#DeleteQuery" title="DeleteQuery"><code class="xref py py-class docutils literal"><span class="pre">DeleteQuery</span></code></a> for the given <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a>.</td>
</tr>
</tbody>
</table>
<p>Add a <code class="docutils literal"><span class="pre">RETURNING</span></code> clause to the query, which will cause the <code class="docutils literal"><span class="pre">DELETE</span></code> to compute return values based on each row that was removed from the database.</p>
<p>When the query is executed, rather than returning the number of rows deleted, an iterator will be returned that yields the deleted objects.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Currently only <a class="reference internal" href="#PostgresqlDatabase" title="PostgresqlDatabase"><code class="xref py py-class docutils literal"><span class="pre">PostgresqlDatabase</span></code></a> supports this feature.</p>
</div>
<p>例:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Create some users, retrieving the list of IDs assigned to them.</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
         <span class="o">.</span><span class="n">delete</span><span class="p">()</span>
         <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">account_expired</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
         <span class="o">.</span><span class="n">returning</span><span class="p">(</span><span class="n">User</span><span class="p">))</span>

<span class="c1"># We can iterate over the user objects that were deleted.</span>
<span class="k">for</span> <span class="n">deleted_user</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">execute</span><span class="p">():</span>
    <span class="c1"># Do something with the deleted user.</span>
    <span class="n">notify_account_deleted</span><span class="p">(</span><span class="n">deleted_user</span><span class="o">.</span><span class="n">email</span><span class="p">)</span>
</pre></div>
</div>
<p>For more information, check out <a class="reference internal" href="querying.html#returning-clause"><span class="std std-ref">the RETURNING clause docs</span></a>.</p>
</dd></dl>

<dl class="method">
<dt id="DeleteQuery.tuples">
<code class="descname">tuples</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#DeleteQuery.tuples" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#DeleteQuery" title="DeleteQuery"><code class="xref py py-class docutils literal"><span class="pre">DeleteQuery</span></code></a></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">This method should only be used in conjunction with a call to <a class="reference internal" href="#DeleteQuery.returning" title="DeleteQuery.returning"><code class="xref py py-meth docutils literal"><span class="pre">returning()</span></code></a>.</p>
</div>
<p>When the deleted results are returned, they will be returned as row tuples.</p>
</dd></dl>

<dl class="method">
<dt id="DeleteQuery.dicts">
<code class="descname">dicts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#DeleteQuery.dicts" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#DeleteQuery" title="DeleteQuery"><code class="xref py py-class docutils literal"><span class="pre">DeleteQuery</span></code></a></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">This method should only be used in conjunction with a call to <a class="reference internal" href="#DeleteQuery.returning" title="DeleteQuery.returning"><code class="xref py py-meth docutils literal"><span class="pre">returning()</span></code></a>.</p>
</div>
<p>When the deleted results are returned, they will be returned as dictionaries mapping column to value.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="RawQuery">
<em class="property">class </em><code class="descname">RawQuery</code><span class="sig-paren">(</span><em>model_class</em>, <em>sql</em>, <em>*params</em><span class="sig-paren">)</span><a class="headerlink" href="#RawQuery" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Allows execution of an arbitrary query and returns instances
of the model via a <code class="xref py py-class docutils literal"><span class="pre">QueryResultsWrapper</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Generally you will only need this for executing highly optimized SELECT
queries.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">If you are executing a parameterized query, you must use the correct
interpolation string for your database.  SQLite uses <code class="docutils literal"><span class="pre">'?'</span></code> and most others
use <code class="docutils literal"><span class="pre">'%s'</span></code>.</p>
</div>
<p>Example selecting users with a given username:</p>
<div class="highlight-pycon"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">rq</span> <span class="o">=</span> <span class="n">RawQuery</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="s1">&#39;SELECT * FROM users WHERE username = ?&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">rq</span><span class="o">.</span><span class="n">execute</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">obj</span>
<span class="go">&lt;User: admin&gt;</span>
</pre></div>
</div>
<dl class="method">
<dt id="RawQuery.tuples">
<code class="descname">tuples</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#RawQuery.tuples" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#RawQuery" title="RawQuery"><code class="xref py py-class docutils literal"><span class="pre">RawQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Flag this query indicating it should simply return raw tuples from the cursor.
This method is useful when you either do not want or do not need full model
instances.</p>
</dd></dl>

<dl class="method">
<dt id="RawQuery.dicts">
<code class="descname">dicts</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#RawQuery.dicts" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body"><a class="reference internal" href="#RawQuery" title="RawQuery"><code class="xref py py-class docutils literal"><span class="pre">RawQuery</span></code></a></td>
</tr>
</tbody>
</table>
<p>Flag this query indicating it should simply return raw dicts from the cursor.
This method is useful when you either do not want or do not need full model
instances.</p>
</dd></dl>

<dl class="method">
<dt id="RawQuery.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#RawQuery.execute" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">a <code class="xref py py-class docutils literal"><span class="pre">QueryResultWrapper</span></code> for iterating over the result set.  The results are instances of the given model.</td>
</tr>
</tbody>
</table>
<p>Performs the query</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="CompoundSelect">
<em class="property">class </em><code class="descname">CompoundSelect</code><span class="sig-paren">(</span><em>model_class</em>, <em>lhs</em>, <em>operator</em>, <em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#CompoundSelect" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Compound select query.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>model_class</strong> – The type of model to return, by default the model class
of the <code class="docutils literal"><span class="pre">lhs</span></code> query.</li>
<li><strong>lhs</strong> – Left-hand query, either a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> or a <code class="xref py py-class docutils literal"><span class="pre">CompoundQuery</span></code>.</li>
<li><strong>operator</strong> – A string used to join the two queries, for example <code class="docutils literal"><span class="pre">'UNION'</span></code>.</li>
<li><strong>rhs</strong> – Right query, either a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> or a <code class="xref py py-class docutils literal"><span class="pre">CompoundQuery</span></code>.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="prefetch">
<code class="descname">prefetch</code><span class="sig-paren">(</span><em>sq</em>, <em>*subqueries</em><span class="sig-paren">)</span><a class="headerlink" href="#prefetch" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first simple">
<li><strong>sq</strong> – <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> instance</li>
<li><strong>subqueries</strong> – one or more <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> instances to prefetch for <code class="docutils literal"><span class="pre">sq</span></code>. You
can also pass models, but they will be converted into SelectQueries. If you wish to specify
a particular model to join against, you can pass a 2-tuple of <code class="docutils literal"><span class="pre">(query_or_model,</span> <span class="pre">join_model)</span></code>.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><p class="first last"><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a> with related instances pre-populated</p>
</td>
</tr>
</tbody>
</table>
<p>Pre-fetch the appropriate instances from the subqueries and apply them to
their corresponding parent row in the outer query. This function will eagerly
load the related instances specified in the subqueries. This is a technique used
to save doing O(n) queries for n rows, and rather is O(k) queries for <em>k</em>
subqueries.</p>
<p>For example, consider you have a list of users and want to display all their
tweets:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s impost some small restrictions on our queries</span>
<span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">User</span><span class="o">.</span><span class="n">active</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">tweets</span> <span class="o">=</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">published</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>

<span class="c1"># this will perform 2 queries</span>
<span class="n">users_pf</span> <span class="o">=</span> <span class="n">prefetch</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">tweets</span><span class="p">)</span>

<span class="c1"># now we can:</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users_pf</span><span class="p">:</span>
    <span class="k">print</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span>
    <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">tweets_prefetch</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;- &#39;</span><span class="p">,</span> <span class="n">tweet</span><span class="o">.</span><span class="n">content</span>
</pre></div>
</div>
<p>You can prefetch an arbitrary number of items.  For instance, suppose we have
a photo site, User -&gt; Photo -&gt; (Comments, Tags).  That is, users can post photos,
and these photos can have tags and comments on them.  If we wanted to fetch a
list of users, all their photos, and all the comments and tags on the photos:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">users</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
<span class="n">published_photos</span> <span class="o">=</span> <span class="n">Photo</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Photo</span><span class="o">.</span><span class="n">published</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">published_comments</span> <span class="o">=</span> <span class="n">Comment</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="p">(</span><span class="n">Comment</span><span class="o">.</span><span class="n">is_spam</span> <span class="o">==</span> <span class="bp">False</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">Comment</span><span class="o">.</span><span class="n">num_flags</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">))</span>

<span class="c1"># note that we are just passing the Tag model -- it will be converted</span>
<span class="c1"># to a query automatically</span>
<span class="n">users_pf</span> <span class="o">=</span> <span class="n">prefetch</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">published_photos</span><span class="p">,</span> <span class="n">published_comments</span><span class="p">,</span> <span class="n">Tag</span><span class="p">)</span>

<span class="c1"># now we can iterate users, photos, and comments/tags</span>
<span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users_pf</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">photo</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">photo_set_prefetch</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">photo</span><span class="o">.</span><span class="n">comment_set_prefetch</span><span class="p">:</span>
            <span class="c1"># ...</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">photo</span><span class="o">.</span><span class="n">tag_set_prefetch</span><span class="p">:</span>
            <span class="c1"># ...</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Subqueries must be related by foreign key and can be arbitrarily deep</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">For more information, see the <a class="reference internal" href="querying.html#nplusone"><span class="std std-ref">N+1クエリを避ける</span></a> document and the <a class="reference internal" href="querying.html#prefetch"><span class="std std-ref">Using prefetch</span></a> sub-section.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last"><a class="reference internal" href="#prefetch" title="prefetch"><code class="xref py py-func docutils literal"><span class="pre">prefetch()</span></code></a> can use up lots of RAM when the result set is large,
and will not warn you if you are doing something dangerous, so it is up
to you to know when to use it.  Additionally, because of the semantics of
subquerying, there may be some cases when prefetch does not act as you
expect (for instance, when applying a <code class="docutils literal"><span class="pre">LIMIT</span></code> to subqueries, but there
may be others) – please report anything you think is a bug to <a class="reference external" href="https://github.com/coleifer/peewee/issues">github</a>.</p>
</div>
</dd></dl>

</div>
<div class="section" id="database-and-its-subclasses">
<h2>データベースとそのサブクエリ<a class="headerlink" href="#database-and-its-subclasses" title="このヘッドラインへのパーマリンク">¶</a></h2>
<dl class="class">
<dt id="Database">
<em class="property">class </em><code class="descname">Database</code><span class="sig-paren">(</span><em>database</em><span class="optional">[</span>, <em>threadlocals=True</em><span class="optional">[</span>, <em>autocommit=True</em><span class="optional">[</span>, <em>fields=None</em><span class="optional">[</span>, <em>ops=None</em><span class="optional">[</span>, <em>autorollback=False</em><span class="optional">[</span>, <em>use_speedups=True</em><span class="optional">[</span>, <em>**connect_kwargs</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>database</strong> – the name of the database (or filename if using sqlite)</li>
<li><strong>threadlocals</strong> (<em>bool</em>) – whether to store connections in a threadlocal</li>
<li><strong>autocommit</strong> (<em>bool</em>) – automatically commit every query executed by calling <a class="reference internal" href="#Database.execute" title="Database.execute"><code class="xref py py-meth docutils literal"><span class="pre">execute()</span></code></a></li>
<li><strong>fields</strong> (<em>dict</em>) – a mapping of <code class="xref py py-attr docutils literal"><span class="pre">db_field</span></code> to database column type, e.g. 『string』 =&gt; 『varchar』</li>
<li><strong>ops</strong> (<em>dict</em>) – a mapping of operations understood by the querycompiler to expressions</li>
<li><strong>autorollback</strong> (<em>bool</em>) – automatically rollback when an exception occurs while executing a query.</li>
<li><strong>use_speedups</strong> (<em>bool</em>) – use the Cython speedups module to improve performance of some queries.</li>
<li><strong>connect_kwargs</strong> – any arbitrary parameters to pass to the database driver when connecting</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal"><span class="pre">connect_kwargs</span></code> dictionary is used for vendor-specific parameters that will be passed back directly to your database driver, allowing you to specify the <code class="docutils literal"><span class="pre">user</span></code>, <code class="docutils literal"><span class="pre">host</span></code> and <code class="docutils literal"><span class="pre">password</span></code>, for instance. For more information and examples, see the <a class="reference internal" href="database.html#vendor-specific-parameters"><span class="std std-ref">vendor-specific parameters document</span></a>.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p>If your database name is not known when the class is declared, you can pass
<code class="docutils literal"><span class="pre">None</span></code> in as the database name which will mark the database as 「deferred」
and any attempt to connect while in this state will raise an exception.  To
initialize your database, call the <a class="reference internal" href="#Database.init" title="Database.init"><code class="xref py py-meth docutils literal"><span class="pre">Database.init()</span></code></a> method with
the database name.</p>
<p class="last">For an in-depth discussion of run-time database configuration, see the <a class="reference internal" href="database.html#deferring-initialization"><span class="std std-ref">実行時のデータベース設定</span></a> section.</p>
</div>
<p>A high-level API for working with the supported database engines. The database class:</p>
<ul class="simple">
<li>Manages the underlying database connection.</li>
<li>Executes queries.</li>
<li>Manage transactions and savepoints.</li>
<li>Create and drop tables and indexes.</li>
<li>Introspect the database.</li>
</ul>
<dl class="attribute">
<dt>
<code class="descname">commit_select = False</code></dt>
<dd><p>Whether to issue a commit after executing a select query.  With some engines
can prevent implicit transactions from piling up.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">compiler_class = QueryCompiler</code></dt>
<dd><p>A class suitable for compiling queries</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">compound_operations = ['UNION', 'INTERSECT', 'EXCEPT']</code></dt>
<dd><p>Supported compound query operations.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">compound_select_parentheses = False</code></dt>
<dd><p>Whether <code class="docutils literal"><span class="pre">UNION</span></code> (or other compound <code class="docutils literal"><span class="pre">SELECT</span></code> queries) allow parentheses around the queries.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">distinct_on = False</code></dt>
<dd><p>Whether the database supports <code class="docutils literal"><span class="pre">DISTINCT</span> <span class="pre">ON</span></code> statements.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">drop_cascade = False</code></dt>
<dd><p>Whether the database supports cascading drop table queries.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">field_overrides = {}</code></dt>
<dd><p>A mapping of field types to database column types, e.g. <code class="docutils literal"><span class="pre">{'primary_key':</span> <span class="pre">'SERIAL'}</span></code></p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">foreign_keys = True</code></dt>
<dd><p>Whether the given backend enforces foreign key constraints.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">for_update = False</code></dt>
<dd><p>Whether the given backend supports selecting rows for update</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">for_update_nowait = False</code></dt>
<dd><p>Whether the given backend supports selecting rows for update</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">insert_many = True</code></dt>
<dd><p>Whether the database supports multiple <code class="docutils literal"><span class="pre">VALUES</span></code> clauses for <code class="docutils literal"><span class="pre">INSERT</span></code> queries.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">insert_returning = False</code></dt>
<dd><p>Whether the database supports returning the primary key for newly inserted rows.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">interpolation = '?'</code></dt>
<dd><p>The string used by the driver to interpolate query parameters</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">op_overrides = {}</code></dt>
<dd><p>A mapping of operation codes to string operations, e.g. <code class="docutils literal"><span class="pre">{OP.LIKE:</span> <span class="pre">'LIKE</span> <span class="pre">BINARY'}</span></code></p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">quote_char = '&quot;'</code></dt>
<dd><p>The string used by the driver to quote names</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">reserved_tables = []</code></dt>
<dd><p>Table names that are reserved by the backend – if encountered in the
application a warning will be issued.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">returning_clause = False</code></dt>
<dd><p>Whether the database supports <code class="docutils literal"><span class="pre">RETURNING</span></code> clauses for <code class="docutils literal"><span class="pre">UPDATE</span></code>, <code class="docutils literal"><span class="pre">INSERT</span></code> and <code class="docutils literal"><span class="pre">DELETE</span></code> queries.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Currently only <a class="reference internal" href="#PostgresqlDatabase" title="PostgresqlDatabase"><code class="xref py py-class docutils literal"><span class="pre">PostgresqlDatabase</span></code></a> supports this.</p>
</div>
<p>See the following for more information:</p>
<ul class="simple">
<li><a class="reference internal" href="#UpdateQuery.returning" title="UpdateQuery.returning"><code class="xref py py-meth docutils literal"><span class="pre">UpdateQuery.returning()</span></code></a></li>
<li><a class="reference internal" href="#InsertQuery.returning" title="InsertQuery.returning"><code class="xref py py-meth docutils literal"><span class="pre">InsertQuery.returning()</span></code></a></li>
<li><a class="reference internal" href="#DeleteQuery.returning" title="DeleteQuery.returning"><code class="xref py py-meth docutils literal"><span class="pre">DeleteQuery.returning()</span></code></a></li>
</ul>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">savepoints = True</code></dt>
<dd><p>Whether the given backend supports savepoints.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">sequences = False</code></dt>
<dd><p>Whether the given backend supports sequences</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">subquery_delete_same_table = True</code></dt>
<dd><p>Whether the given backend supports deleting rows using a subquery
that selects from the same table</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="descname">window_functions = False</code></dt>
<dd><p>Whether the given backend supports window functions.</p>
</dd></dl>

<dl class="method">
<dt id="Database.init">
<code class="descname">init</code><span class="sig-paren">(</span><em>database</em><span class="optional">[</span>, <em>**connect_kwargs</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.init" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>This method is used to initialize a deferred database. For details on configuring your database at run-time, see the <a class="reference internal" href="database.html#deferring-initialization"><span class="std std-ref">実行時のデータベース設定</span></a> section.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>database</strong> – the name of the database (or filename if using sqlite)</li>
<li><strong>connect_kwargs</strong> – any arbitrary parameters to pass to the database driver when connecting</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.connect">
<code class="descname">connect</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.connect" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Establishes a connection to the database</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">By default, connections will be stored on a threadlocal, ensuring connections are not shared across threads. To disable this behavior, initialize the database with <code class="docutils literal"><span class="pre">threadlocals=False</span></code>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.close">
<code class="descname">close</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.close" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Closes the connection to the database (if one is open)</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">If you initialized with <code class="docutils literal"><span class="pre">threadlocals=True</span></code>, only a connection local
to the calling thread will be closed.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.initialize_connection">
<code class="descname">initialize_connection</code><span class="sig-paren">(</span><em>conn</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.initialize_connection" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Perform additional intialization on a newly-opened connection. For example, if you are using SQLite you may want to enable foreign key constraint enforcement (off by default).</p>
<p>Here is how you might use this hook to load a SQLite extension:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CustomSqliteDatabase</span><span class="p">(</span><span class="n">SqliteDatabase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conn</span><span class="p">):</span>
        <span class="n">conn</span><span class="o">.</span><span class="n">load_extension</span><span class="p">(</span><span class="s1">&#39;fts5&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.get_conn">
<code class="descname">get_conn</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_conn" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">a connection to the database, creates one if does not exist</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_cursor">
<code class="descname">get_cursor</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_cursor" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">a cursor for executing queries</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.last_insert_id">
<code class="descname">last_insert_id</code><span class="sig-paren">(</span><em>cursor</em>, <em>model</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.last_insert_id" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first simple">
<li><strong>cursor</strong> – the database cursor used to perform the insert query</li>
<li><strong>model</strong> – the model class that was just created</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><p class="first last">the primary key of the most recently inserted instance</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.rows_affected">
<code class="descname">rows_affected</code><span class="sig-paren">(</span><em>cursor</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.rows_affected" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">number of rows affected by the last query</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.compiler">
<code class="descname">compiler</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.compiler" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">an instance of <code class="xref py py-class docutils literal"><span class="pre">QueryCompiler</span></code> using the field and
op overrides specified.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.execute">
<code class="descname">execute</code><span class="sig-paren">(</span><em>clause</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.execute" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>clause</strong> (<a class="reference internal" href="#Node" title="Node"><em>Node</em></a>) – a <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> instance or subclass (e.g. a <a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a>).</td>
</tr>
</tbody>
</table>
<p>The clause will be compiled into SQL then sent to the <a class="reference internal" href="#Database.execute_sql" title="Database.execute_sql"><code class="xref py py-meth docutils literal"><span class="pre">execute_sql()</span></code></a> method.</p>
</dd></dl>

<dl class="method">
<dt id="Database.execute_sql">
<code class="descname">execute_sql</code><span class="sig-paren">(</span><em>sql</em><span class="optional">[</span>, <em>params=None</em><span class="optional">[</span>, <em>require_commit=True</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.execute_sql" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>sql</strong> – a string sql query</li>
<li><strong>params</strong> – a list or tuple of parameters to interpolate</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">You can configure whether queries will automatically commit by using
the <a class="reference internal" href="#Database.set_autocommit" title="Database.set_autocommit"><code class="xref py py-meth docutils literal"><span class="pre">set_autocommit()</span></code></a> and <a class="reference internal" href="#Database.get_autocommit" title="Database.get_autocommit"><code class="xref py py-meth docutils literal"><span class="pre">Database.get_autocommit()</span></code></a>
methods.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.begin">
<code class="descname">begin</code><span class="sig-paren">(</span><span class="optional">[</span><em>lock_type=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.begin" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Initiate a new transaction.  By default <strong>not</strong> implemented as this is not
part of the DB-API 2.0, but provided for API compatibility and to allow
SQLite users to specify the isolation level when beginning transactions.</p>
<p>For SQLite users, the valid isolation levels for <code class="docutils literal"><span class="pre">lock_type</span></code> are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">exclusive</span></code></li>
<li><code class="docutils literal"><span class="pre">immediate</span></code></li>
<li><code class="docutils literal"><span class="pre">deferred</span></code></li>
</ul>
<p>Example usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Calling transaction() in turn calls begin(&#39;exclusive&#39;).</span>
<span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span><span class="s1">&#39;exclusive&#39;</span><span class="p">):</span>
    <span class="c1"># No other readers or writers allowed while this is active.</span>
    <span class="p">(</span><span class="n">Account</span>
     <span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">balance</span><span class="o">=</span><span class="n">Account</span><span class="o">.</span><span class="n">balance</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span>
     <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">from_acct</span><span class="p">)</span>
     <span class="o">.</span><span class="n">execute</span><span class="p">())</span>

    <span class="p">(</span><span class="n">Account</span>
     <span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">balance</span><span class="o">=</span><span class="n">Account</span><span class="o">.</span><span class="n">balance</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>
     <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">to_acct</span><span class="p">)</span>
     <span class="o">.</span><span class="n">execute</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.commit">
<code class="descname">commit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.commit" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Call <code class="docutils literal"><span class="pre">commit()</span></code> on the active connection, committing the current transaction.</p>
</dd></dl>

<dl class="method">
<dt id="Database.rollback">
<code class="descname">rollback</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.rollback" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Call <code class="docutils literal"><span class="pre">rollback()</span></code> on the active connection, rolling back the current transaction.</p>
</dd></dl>

<dl class="method">
<dt id="Database.set_autocommit">
<code class="descname">set_autocommit</code><span class="sig-paren">(</span><em>autocommit</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.set_autocommit" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>autocommit</strong> – a boolean value indicating whether to turn on/off autocommit.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_autocommit">
<code class="descname">get_autocommit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_autocommit" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">a boolean value indicating whether autocommit is enabled.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_tables">
<code class="descname">get_tables</code><span class="sig-paren">(</span><span class="optional">[</span><em>schema=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_tables" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">a list of table names in the database.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_indexes">
<code class="descname">get_indexes</code><span class="sig-paren">(</span><em>table</em><span class="optional">[</span>, <em>schema=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_indexes" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">a list of <a class="reference internal" href="#IndexMetadata" title="IndexMetadata"><code class="xref py py-class docutils literal"><span class="pre">IndexMetadata</span></code></a> instances, representing the indexes for the given table.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_columns">
<code class="descname">get_columns</code><span class="sig-paren">(</span><em>table</em><span class="optional">[</span>, <em>schema=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_columns" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">a list of <a class="reference internal" href="#ColumnMetadata" title="ColumnMetadata"><code class="xref py py-class docutils literal"><span class="pre">ColumnMetadata</span></code></a> instances, representing the columns for the given table.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_primary_keys">
<code class="descname">get_primary_keys</code><span class="sig-paren">(</span><em>table</em><span class="optional">[</span>, <em>schema=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_primary_keys" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">a list containing the primary key column name(s) for the given table.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.get_foreign_keys">
<code class="descname">get_foreign_keys</code><span class="sig-paren">(</span><em>table</em><span class="optional">[</span>, <em>schema=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.get_foreign_keys" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">戻り値の型:</th><td class="field-body">a list of <a class="reference internal" href="#ForeignKeyMetadata" title="ForeignKeyMetadata"><code class="xref py py-class docutils literal"><span class="pre">ForeignKeyMetadata</span></code></a> instances, representing the foreign keys for the given table.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.sequence_exists">
<code class="descname">sequence_exists</code><span class="sig-paren">(</span><em>sequence_name</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.sequence_exists" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Rtype boolean:</th><td class="field-body"></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.create_table">
<code class="descname">create_table</code><span class="sig-paren">(</span><em>model_class</em><span class="optional">[</span>, <em>safe=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.create_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>model_class</strong> – <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> class.</li>
<li><strong>safe</strong> (<em>bool</em>) – If <cite>True</cite>, the table will not be created if it already exists.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">Unlike <a class="reference internal" href="#Model.create_table" title="Model.create_table"><code class="xref py py-meth docutils literal"><span class="pre">Model.create_table()</span></code></a>, this method does not create indexes or constraints. This method will only create the table itself. If you wish to create the table along with any indexes and constraints, use either <a class="reference internal" href="#Model.create_table" title="Model.create_table"><code class="xref py py-meth docutils literal"><span class="pre">Model.create_table()</span></code></a> or <a class="reference internal" href="#Database.create_tables" title="Database.create_tables"><code class="xref py py-meth docutils literal"><span class="pre">Database.create_tables()</span></code></a>.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.create_index">
<code class="descname">create_index</code><span class="sig-paren">(</span><em>model_class</em>, <em>fields</em><span class="optional">[</span>, <em>unique=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.create_index" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>model_class</strong> – <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> table on which to create index</li>
<li><strong>fields</strong> – field(s) to create index on (either field instances or field names)</li>
<li><strong>unique</strong> – whether the index should enforce uniqueness</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.create_foreign_key">
<code class="descname">create_foreign_key</code><span class="sig-paren">(</span><em>model_class</em>, <em>field</em><span class="optional">[</span>, <em>constraint=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.create_foreign_key" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>model_class</strong> – <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> table on which to create foreign key constraint</li>
<li><strong>field</strong> – <code class="xref py py-class docutils literal"><span class="pre">Field</span></code> object</li>
<li><strong>constraint</strong> (<em>str</em>) – Name to give foreign key constraint.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Manually create a foreign key constraint using an <code class="docutils literal"><span class="pre">ALTER</span> <span class="pre">TABLE</span></code> query.
This is primarily used when creating a circular foreign key dependency,
for example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">DeferredPost</span> <span class="o">=</span> <span class="n">DeferredRelation</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">favorite_post</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">DeferredPost</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;posts&#39;</span><span class="p">)</span>

<span class="n">DeferredPost</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span><span class="n">Post</span><span class="p">)</span>

<span class="c1"># Create tables.  The foreign key from Post -&gt; User will be created</span>
<span class="c1"># automatically, but the foreign key from User -&gt; Post must be added</span>
<span class="c1"># manually.</span>
<span class="n">User</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>
<span class="n">Post</span><span class="o">.</span><span class="n">create_table</span><span class="p">()</span>

<span class="c1"># Manually add the foreign key constraint on `User`, since we could</span>
<span class="c1"># not add it until we had created the `Post` table.</span>
<span class="n">db</span><span class="o">.</span><span class="n">create_foreign_key</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">favorite_post</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.create_sequence">
<code class="descname">create_sequence</code><span class="sig-paren">(</span><em>sequence_name</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.create_sequence" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>sequence_name</strong> – name of sequence to create</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">only works with database engines that support sequences</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.drop_table">
<code class="descname">drop_table</code><span class="sig-paren">(</span><em>model_class</em><span class="optional">[</span>, <em>fail_silently=False</em><span class="optional">[</span>, <em>cascade=False</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.drop_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>model_class</strong> – <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> table to drop</li>
<li><strong>fail_silently</strong> (<em>bool</em>) – if <code class="docutils literal"><span class="pre">True</span></code>, query will add a <code class="docutils literal"><span class="pre">IF</span> <span class="pre">EXISTS</span></code> clause</li>
<li><strong>cascade</strong> (<em>bool</em>) – drop table with <code class="docutils literal"><span class="pre">CASCADE</span></code> option.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.drop_sequence">
<code class="descname">drop_sequence</code><span class="sig-paren">(</span><em>sequence_name</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.drop_sequence" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>sequence_name</strong> – name of sequence to drop</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">only works with database engines that support sequences</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.create_tables">
<code class="descname">create_tables</code><span class="sig-paren">(</span><em>models</em><span class="optional">[</span>, <em>safe=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.create_tables" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>models</strong> (<em>list</em>) – A list of models.</li>
<li><strong>safe</strong> (<em>bool</em>) – Check first whether the table exists before attempting to create it.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method should be used for creating tables as it will resolve the model dependency graph and ensure the tables are created in the correct order. This method will also create any indexes and constraints defined on the models.</p>
<p>Usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">create_tables</span><span class="p">([</span><span class="n">User</span><span class="p">,</span> <span class="n">Tweet</span><span class="p">,</span> <span class="n">Something</span><span class="p">],</span> <span class="n">safe</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.drop_tables">
<code class="descname">drop_tables</code><span class="sig-paren">(</span><em>models</em><span class="optional">[</span>, <em>safe=False</em><span class="optional">[</span>, <em>cascade=False</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.drop_tables" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>models</strong> (<em>list</em>) – A list of models.</li>
<li><strong>safe</strong> (<em>bool</em>) – Check the table exists before attempting to drop it.</li>
<li><strong>cascade</strong> (<em>bool</em>) – drop table with <code class="docutils literal"><span class="pre">CASCADE</span></code> option.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This method should be used for dropping tables, as it will resolve the model dependency graph and ensure the tables are dropped in the correct order.</p>
<p>Usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">db</span><span class="o">.</span><span class="n">drop_tables</span><span class="p">([</span><span class="n">User</span><span class="p">,</span> <span class="n">Tweet</span><span class="p">,</span> <span class="n">Something</span><span class="p">],</span> <span class="n">safe</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.atomic">
<code class="descname">atomic</code><span class="sig-paren">(</span><span class="optional">[</span><em>transaction_type=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.atomic" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Execute statements in either a transaction or a savepoint. The outer-most call to <em>atomic</em> will use a transaction,
and any subsequent nested calls will use savepoints.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>transaction_type</strong> (<em>str</em>) – Specify isolation level. This parameter
only has effect on <strong>SQLite databases</strong>, and furthermore, only
affects the outer-most call to <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">atomic()</span></code></a>. For
more information, see <a class="reference internal" href="#Database.transaction" title="Database.transaction"><code class="xref py py-meth docutils literal"><span class="pre">transaction()</span></code></a>.</td>
</tr>
</tbody>
</table>
<p><code class="docutils literal"><span class="pre">atomic</span></code> can be used as either a context manager or a decorator.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">For most use-cases, it makes the most sense to always use <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">atomic()</span></code></a> when you wish to execute queries in a transaction. The benefit of using <code class="docutils literal"><span class="pre">atomic</span></code> is that you do not need to manually keep track of the transaction stack depth, as this will be managed for you.</p>
</div>
<p>Context manager example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">atomic</span><span class="p">()</span> <span class="k">as</span> <span class="n">txn</span><span class="p">:</span>
    <span class="n">perform_some_operations</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">atomic</span><span class="p">()</span> <span class="k">as</span> <span class="n">nested_txn</span><span class="p">:</span>
        <span class="n">do_other_things</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">something_bad_happened</span><span class="p">():</span>
            <span class="c1"># Roll back these changes, but preserve the changes</span>
            <span class="c1"># made in the outer block.</span>
            <span class="n">nested_txn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</pre></div>
</div>
<p>Decorator example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@db.atomic</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="c1"># This function will execute in a transaction/savepoint.</span>
    <span class="k">return</span> <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.transaction">
<code class="descname">transaction</code><span class="sig-paren">(</span><span class="optional">[</span><em>transaction_type=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.transaction" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Execute statements in a transaction using either a context manager or decorator. If an
error is raised inside the wrapped block, the transaction will be rolled
back, otherwise statements are committed when exiting. Transactions can also be explicitly rolled back or committed within the transaction block by calling <a class="reference internal" href="#transaction.rollback" title="transaction.rollback"><code class="xref py py-meth docutils literal"><span class="pre">rollback()</span></code></a> or <a class="reference internal" href="#transaction.commit" title="transaction.commit"><code class="xref py py-meth docutils literal"><span class="pre">commit()</span></code></a>. If you manually commit or roll back, a new transaction will be started automatically.</p>
<p>Nested blocks can be wrapped with <code class="docutils literal"><span class="pre">transaction</span></code> - the database
will keep a stack and only commit when it reaches the end of the outermost
function / block.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>transaction_type</strong> (<em>str</em>) – Specify isolation level, <strong>SQLite only</strong>.</td>
</tr>
</tbody>
</table>
<p>Context manager example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># delete a blog instance and all its associated entries, but</span>
<span class="c1"># do so within a transaction</span>
<span class="k">with</span> <span class="n">database</span><span class="o">.</span><span class="n">transaction</span><span class="p">():</span>
    <span class="n">blog</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">(</span><span class="n">recursive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


<span class="c1"># Explicitly roll back a transaction.</span>
<span class="k">with</span> <span class="n">database</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">txn</span><span class="p">:</span>
    <span class="n">do_some_stuff</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">something_bad_happened</span><span class="p">():</span>
        <span class="c1"># Roll back any changes made within this block.</span>
        <span class="n">txn</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</pre></div>
</div>
<p>Decorator example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="nd">@database.transaction</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">transfer_money</span><span class="p">(</span><span class="n">from_acct</span><span class="p">,</span> <span class="n">to_acct</span><span class="p">,</span> <span class="n">amt</span><span class="p">):</span>
    <span class="n">from_acct</span><span class="o">.</span><span class="n">charge</span><span class="p">(</span><span class="n">amt</span><span class="p">)</span>
    <span class="n">to_acct</span><span class="o">.</span><span class="n">pay</span><span class="p">(</span><span class="n">amt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">amt</span>
</pre></div>
</div>
<p>SQLite users can specify the isolation level by specifying one of the
following values for <code class="docutils literal"><span class="pre">transaction_type</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">exclusive</span></code></li>
<li><code class="docutils literal"><span class="pre">immediate</span></code></li>
<li><code class="docutils literal"><span class="pre">deferred</span></code></li>
</ul>
<p>Example usage:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span><span class="s1">&#39;exclusive&#39;</span><span class="p">):</span>
    <span class="c1"># No other readers or writers allowed while this is active.</span>
    <span class="p">(</span><span class="n">Account</span>
     <span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">balance</span><span class="o">=</span><span class="n">Account</span><span class="o">.</span><span class="n">balance</span> <span class="o">-</span> <span class="mi">100</span><span class="p">)</span>
     <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">from_acct</span><span class="p">)</span>
     <span class="o">.</span><span class="n">execute</span><span class="p">())</span>

    <span class="p">(</span><span class="n">Account</span>
     <span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">balance</span><span class="o">=</span><span class="n">Account</span><span class="o">.</span><span class="n">balance</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span>
     <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Account</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">to_acct</span><span class="p">)</span>
     <span class="o">.</span><span class="n">execute</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.commit_on_success">
<code class="descname">commit_on_success</code><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.commit_on_success" title="この定義へのパーマリンク">¶</a></dt>
<dd><div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Use <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">atomic()</span></code></a> or <a class="reference internal" href="#Database.transaction" title="Database.transaction"><code class="xref py py-meth docutils literal"><span class="pre">transaction()</span></code></a> instead.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.savepoint">
<code class="descname">savepoint</code><span class="sig-paren">(</span><span class="optional">[</span><em>sid=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.savepoint" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Execute statements in a savepoint using either a context manager or decorator.  If an
error is raised inside the wrapped block, the savepoint will be rolled
back, otherwise statements are committed when exiting. Like <a class="reference internal" href="#Database.transaction" title="Database.transaction"><code class="xref py py-meth docutils literal"><span class="pre">transaction()</span></code></a>, a savepoint can also be explicitly rolled-back or committed by calling <a class="reference internal" href="#savepoint.rollback" title="savepoint.rollback"><code class="xref py py-meth docutils literal"><span class="pre">rollback()</span></code></a> or <a class="reference internal" href="#savepoint.commit" title="savepoint.commit"><code class="xref py py-meth docutils literal"><span class="pre">commit()</span></code></a>. If you manually commit or roll back, a new savepoint <strong>will not</strong> be created.</p>
<p>Savepoints can be thought of as nested transactions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>sid</strong> (<em>str</em>) – An optional string identifier for the savepoint.</td>
</tr>
</tbody>
</table>
<p>Context manager example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">txn</span><span class="p">:</span>
    <span class="n">do_some_stuff</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">savepoint</span><span class="p">()</span> <span class="k">as</span> <span class="n">sp1</span><span class="p">:</span>
        <span class="n">do_more_things</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">savepoint</span><span class="p">()</span> <span class="k">as</span> <span class="n">sp2</span><span class="p">:</span>
        <span class="n">even_more</span><span class="p">()</span>
        <span class="c1"># Oops, something bad happened, roll back</span>
        <span class="c1"># just the changes made in this block.</span>
        <span class="k">if</span> <span class="n">something_bad_happened</span><span class="p">():</span>
            <span class="n">sp2</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Database.execution_context">
<code class="descname">execution_context</code><span class="sig-paren">(</span><span class="optional">[</span><em>with_transaction=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Database.execution_context" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Create an <a class="reference internal" href="#ExecutionContext" title="ExecutionContext"><code class="xref py py-class docutils literal"><span class="pre">ExecutionContext</span></code></a> context manager or decorator. Blocks wrapped with an <em>ExecutionContext</em> will run using their own connection. By default, the wrapped block will also run in a transaction, although this can be disabled specifyin <code class="docutils literal"><span class="pre">with_transaction=False</span></code>.</p>
<p>For more explanation of <a class="reference internal" href="#ExecutionContext" title="ExecutionContext"><code class="xref py py-class docutils literal"><span class="pre">ExecutionContext</span></code></a>, see the <a class="reference internal" href="database.html#advanced-connection-management"><span class="std std-ref">高度な接続管理</span></a> section.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">ExecutionContext is very new and has not been tested extensively.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="Database.register_fields">
<em class="property">classmethod </em><code class="descname">register_fields</code><span class="sig-paren">(</span><em>fields</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.register_fields" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Register a mapping of field overrides for the database class.  Used
to register custom fields or override the defaults.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>fields</strong> (<em>dict</em>) – A mapping of <code class="xref py py-attr docutils literal"><span class="pre">db_field</span></code> to column type</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="Database.register_ops">
<em class="property">classmethod </em><code class="descname">register_ops</code><span class="sig-paren">(</span><em>ops</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.register_ops" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Register a mapping of operations understood by the QueryCompiler to their
SQL equivalent, e.g. <code class="docutils literal"><span class="pre">{OP.EQ:</span> <span class="pre">'='}</span></code>.  Used to extend the types of field
comparisons.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>fields</strong> (<em>dict</em>) – A mapping of <code class="xref py py-attr docutils literal"><span class="pre">db_field</span></code> to column type</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.extract_date">
<code class="descname">extract_date</code><span class="sig-paren">(</span><em>date_part</em>, <em>date_field</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.extract_date" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Return an expression suitable for extracting a date part from a date
field.  For instance, extract the year from a <a class="reference internal" href="#DateTimeField" title="DateTimeField"><code class="xref py py-class docutils literal"><span class="pre">DateTimeField</span></code></a>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first simple">
<li><strong>date_part</strong> (<em>str</em>) – The date part attribute to retrieve.  Valid options
are: 「year」, 「month」, 「day」, 「hour」, 「minute」 and 「second」.</li>
<li><strong>date_field</strong> (<em>Field</em>) – field instance storing a datetime, date or time.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><p class="first last">an expression object.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="Database.truncate_date">
<code class="descname">truncate_date</code><span class="sig-paren">(</span><em>date_part</em>, <em>date_field</em><span class="sig-paren">)</span><a class="headerlink" href="#Database.truncate_date" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Return an expression suitable for truncating a date / datetime to the given resolution. This can be used, for example, to group a collection of timestamps by day.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first simple">
<li><strong>date_part</strong> (<em>str</em>) – The date part to truncate to. Valid options are: 「year」, 「month」, 「day」, 「hour」, 「minute」 and 「second」.</li>
<li><strong>date_field</strong> (<em>Field</em>) – field instance storing a datetime, date or time.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">戻り値の型:</th><td class="field-body"><p class="first last">an expression object.</p>
</td>
</tr>
</tbody>
</table>
<p>例:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Get tweets from today.</span>
<span class="n">tweets</span> <span class="o">=</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">db</span><span class="o">.</span><span class="n">truncate_date</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">Tweet</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">==</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">())</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="SqliteDatabase">
<em class="property">class </em><code class="descname">SqliteDatabase</code><span class="sig-paren">(</span><em>Database</em><span class="sig-paren">)</span><a class="headerlink" href="#SqliteDatabase" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#Database" title="Database"><code class="xref py py-class docutils literal"><span class="pre">Database</span></code></a> subclass that works with the <code class="docutils literal"><span class="pre">sqlite3</span></code> driver (or <code class="docutils literal"><span class="pre">pysqlite2</span></code>). In addition to the default database parameters, <a class="reference internal" href="#SqliteDatabase" title="SqliteDatabase"><code class="xref py py-class docutils literal"><span class="pre">SqliteDatabase</span></code></a> also accepts a <em>journal_mode</em> parameter which will configure the journaling mode.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">If you have both <code class="docutils literal"><span class="pre">sqlite3</span></code> and <code class="docutils literal"><span class="pre">pysqlite2</span></code> installed on your system, peewee will use whichever points at a newer version of SQLite.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">SQLite is unique among the databases supported by Peewee in that it allows a high degree of customization by the host application. This means you can do things like write custom functions or aggregates <em>in Python</em> and then call them from your SQL queries. This feature, and many more, are available through the <a class="reference internal" href="playhouse.html#SqliteExtDatabase" title="SqliteExtDatabase"><code class="xref py py-class docutils literal"><span class="pre">SqliteExtDatabase</span></code></a>, part of <code class="docutils literal"><span class="pre">playhouse.sqlite_ext</span></code>. I <em>strongly</em> recommend you use <a class="reference internal" href="playhouse.html#SqliteExtDatabase" title="SqliteExtDatabase"><code class="xref py py-class docutils literal"><span class="pre">SqliteExtDatabase</span></code></a> as it exposes many of the features that make SQLite so powerful.</p>
</div>
<p>Custom parameters:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>journal_mode</strong> (<em>str</em>) – Journaling mode.</li>
<li><strong>pragmas</strong> (<em>list</em>) – List of 2-tuples containing <code class="docutils literal"><span class="pre">PRAGMA</span></code> statements to run against new connections.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>SQLite allows run-time configuration of a number of parameters through <code class="docutils literal"><span class="pre">PRAGMA</span></code> statements (<a class="reference external" href="https://www.sqlite.org/pragma.html">documentation</a>). These statements are typically run against a new database connection. To run one or more <code class="docutils literal"><span class="pre">PRAGMA</span></code> statements against new connections, you can specify them as a list of 2-tuples containing the pragma name and value:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s1">&#39;my_app.db&#39;</span><span class="p">,</span> <span class="n">pragmas</span><span class="o">=</span><span class="p">(</span>
    <span class="p">(</span><span class="s1">&#39;journal_mode&#39;</span><span class="p">,</span> <span class="s1">&#39;WAL&#39;</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;cache_size&#39;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;mmap_size&#39;</span><span class="p">,</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">32</span><span class="p">),</span>
<span class="p">))</span>
</pre></div>
</div>
<dl class="attribute">
<dt>
<code class="descname">insert_many = True *if* using SQLite 3.7.11.0 or newer.</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="MySQLDatabase">
<em class="property">class </em><code class="descname">MySQLDatabase</code><span class="sig-paren">(</span><em>Database</em><span class="sig-paren">)</span><a class="headerlink" href="#MySQLDatabase" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#Database" title="Database"><code class="xref py py-class docutils literal"><span class="pre">Database</span></code></a> subclass that works with either 「MySQLdb」 or 「pymysql」.</p>
<dl class="attribute">
<dt>
<code class="descname">commit_select = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">compound_operations = ['UNION']</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">for_update = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">subquery_delete_same_table = False</code></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="PostgresqlDatabase">
<em class="property">class </em><code class="descname">PostgresqlDatabase</code><span class="sig-paren">(</span><em>Database</em><span class="sig-paren">)</span><a class="headerlink" href="#PostgresqlDatabase" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#Database" title="Database"><code class="xref py py-class docutils literal"><span class="pre">Database</span></code></a> subclass that works with the 「psycopg2」 driver</p>
<dl class="attribute">
<dt>
<code class="descname">commit_select = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">compound_select_parentheses = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">distinct_on = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">for_update = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">for_update_nowait = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">insert_returning = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">returning_clause = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">sequences = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">window_functions = True</code></dt>
<dd></dd></dl>

<dl class="attribute">
<dt>
<code class="descname">register_unicode = True</code></dt>
<dd><p>Control whether the <code class="docutils literal"><span class="pre">UNICODE</span></code> and <code class="docutils literal"><span class="pre">UNICODEARRAY</span></code> psycopg2 extensions are loaded automatically.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="transaction-savepoint-and-executioncontext">
<h2>トランザクション、セーブポイントおよびExecutionContext<a class="headerlink" href="#transaction-savepoint-and-executioncontext" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>The easiest way to create transactions and savepoints is to use <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">Database.atomic()</span></code></a>. The <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">atomic()</span></code></a> method will create a transaction or savepoint depending on the level of nesting.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">atomic</span><span class="p">()</span> <span class="k">as</span> <span class="n">txn</span><span class="p">:</span>
    <span class="c1"># The outer-most call will be a transaction.</span>
    <span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">atomic</span><span class="p">()</span> <span class="k">as</span> <span class="n">sp</span><span class="p">:</span>
        <span class="c1"># Nested calls will be savepoints instead.</span>
        <span class="n">execute_some_statements</span><span class="p">()</span>
</pre></div>
</div>
<dl class="class">
<dt id="transaction">
<em class="property">class </em><code class="descname">transaction</code><span class="sig-paren">(</span><em>database</em><span class="sig-paren">)</span><a class="headerlink" href="#transaction" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Context manager that encapsulates a database transaction. Statements executed within the wrapped block will be committed at the end of the block unless an exception occurs, in which case any changes will be rolled back.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">Transactions should not be nested as this could lead to unpredictable behavior in the event of an exception in a nested block. If you wish to use nested transactions, use the <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">atomic()</span></code></a> method, which will create a transaction at the outer-most layer and use savepoints for nested blocks.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">In practice you should not create <a class="reference internal" href="#transaction" title="transaction"><code class="xref py py-class docutils literal"><span class="pre">transaction</span></code></a> objects directly, but rather use the <a class="reference internal" href="#Database.transaction" title="Database.transaction"><code class="xref py py-meth docutils literal"><span class="pre">Database.transaction()</span></code></a> method.</p>
</div>
<dl class="method">
<dt id="transaction.commit">
<code class="descname">commit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#transaction.commit" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Manually commit any pending changes and begin a new transaction.</p>
</dd></dl>

<dl class="method">
<dt id="transaction.rollback">
<code class="descname">rollback</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#transaction.rollback" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Manually roll-back any pending changes and begin a new transaction.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="savepoint">
<em class="property">class </em><code class="descname">savepoint</code><span class="sig-paren">(</span><em>database</em><span class="optional">[</span>, <em>sid=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#savepoint" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Context manager that encapsulates a savepoint (nested transaction). Statements executed within the wrapped block will be committed at the end of the block unless an exception occurs, in which case any changes will be rolled back.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">Savepoints must be created within a transaction. It is recommended that you use <a class="reference internal" href="#Database.atomic" title="Database.atomic"><code class="xref py py-meth docutils literal"><span class="pre">atomic()</span></code></a> instead of manually managing the transaction+savepoint stack.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">In practice you should not create <a class="reference internal" href="#savepoint" title="savepoint"><code class="xref py py-class docutils literal"><span class="pre">savepoint</span></code></a> objects directly, but rather use the <a class="reference internal" href="#Database.savepoint" title="Database.savepoint"><code class="xref py py-meth docutils literal"><span class="pre">Database.savepoint()</span></code></a> method.</p>
</div>
<dl class="method">
<dt id="savepoint.commit">
<code class="descname">commit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#savepoint.commit" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Manually commit any pending changes. If the savepoint is manually committed and additional changes are made, they will be executed in the context of the outer block.</p>
</dd></dl>

<dl class="method">
<dt id="savepoint.rollback">
<code class="descname">rollback</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#savepoint.rollback" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Manually roll-back any pending changes. If the savepoint is manually rolled-back and additional changes are made, they will be executed in the context of the outer block.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ExecutionContext">
<em class="property">class </em><code class="descname">ExecutionContext</code><span class="sig-paren">(</span><em>database</em><span class="optional">[</span>, <em>with_transaction=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#ExecutionContext" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>ExecutionContext provides a way to explicitly run statements in a dedicated connection. Typically a single database connection is maintained per-thread, but in some situations you may wish to explicitly force a new, separate connection. To accomplish this, you can create an <a class="reference internal" href="#ExecutionContext" title="ExecutionContext"><code class="xref py py-class docutils literal"><span class="pre">ExecutionContext</span></code></a>. Statements executed in the wrapped block will be run in a transaction by default, though you can disable this by specifying <code class="docutils literal"><span class="pre">with_transaction=False</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">Rather than instantiating <code class="docutils literal"><span class="pre">ExecutionContext</span></code> directly, use <a class="reference internal" href="#Database.execution_context" title="Database.execution_context"><code class="xref py py-meth docutils literal"><span class="pre">Database.execution_context()</span></code></a>.</p>
</div>
<p>Example code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># This will return the connection associated with the current thread.</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_conn</span><span class="p">()</span>

<span class="k">with</span> <span class="n">db</span><span class="o">.</span><span class="n">execution_context</span><span class="p">():</span>
    <span class="c1"># This will be a new connection object. If you are using the</span>
    <span class="c1"># connection pool, it may be an unused connection from the pool.</span>
    <span class="n">ctx_conn</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_conn</span><span class="p">()</span>

    <span class="c1"># This statement is executed using the new `ctx_conn`.</span>
    <span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;huey&#39;</span><span class="p">)</span>

<span class="c1"># At the end of the wrapped block, the connection will be closed and the</span>
<span class="c1"># transaction, if one exists, will be committed.</span>

<span class="c1"># This statement is executed using the regular `conn`.</span>
<span class="n">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;mickey&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="Using">
<em class="property">class </em><code class="descname">Using</code><span class="sig-paren">(</span><em>database</em>, <em>models</em><span class="optional">[</span>, <em>with_transaction=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Using" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>For the duration of the wrapped block, all queries against the given <code class="docutils literal"><span class="pre">models</span></code> will use the specified <code class="docutils literal"><span class="pre">database</span></code>. Optionally these queries can be run outside a transaction by specifying <code class="docutils literal"><span class="pre">with_transaction=False</span></code>.</p>
<p><code class="docutils literal"><span class="pre">Using</span></code> provides, in short, a way to run queries on a list of models using a manually specified database.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>database</strong> – a <a class="reference internal" href="#Database" title="Database"><code class="xref py py-class docutils literal"><span class="pre">Database</span></code></a> instance.</li>
<li><strong>models</strong> – a list of <a class="reference internal" href="#Model" title="Model"><code class="xref py py-class docutils literal"><span class="pre">Model</span></code></a> classes to use with the given database.</li>
<li><strong>with_transaction</strong> – Whether the wrapped block should be run in a transaction.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p class="last">The <a class="reference internal" href="#Using" title="Using"><code class="xref py py-class docutils literal"><span class="pre">Using</span></code></a> context manager does not do anything to manage
the database connections, so it the user’s responsibility to make sure
that you close the database explicitly.</p>
</div>
<p>例:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">master</span> <span class="o">=</span> <span class="n">PostgresqlDatabase</span><span class="p">(</span><span class="s1">&#39;master&#39;</span><span class="p">)</span>
<span class="n">replica</span> <span class="o">=</span> <span class="n">PostgresqlDatabase</span><span class="p">(</span><span class="s1">&#39;replica&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">IntegerField</span><span class="p">()</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">master</span>

<span class="c1"># All these queries use the &quot;master&quot; database,</span>
<span class="c1"># since that is what our Data model was configured</span>
<span class="c1"># to use.</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">Data</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>

<span class="n">Data</span><span class="o">.</span><span class="n">insert_many</span><span class="p">({</span><span class="n">Data</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="n">j</span><span class="p">}</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>

<span class="c1"># To use the read replica, we can use the Using context manager.</span>
<span class="k">with</span> <span class="n">Using</span><span class="p">(</span><span class="n">read_replica</span><span class="p">,</span> <span class="p">[</span><span class="n">Data</span><span class="p">]):</span>
    <span class="c1"># Query is executed against the read replica.</span>
    <span class="n">n_data</span> <span class="o">=</span> <span class="n">Data</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

    <span class="c1"># Since we did not specify this model in the list passed</span>
    <span class="c1"># to Using, it will use whatever database it was defined with.</span>
    <span class="n">other_count</span> <span class="o">=</span> <span class="n">SomeOtherModel</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="metadata-types">
<h2>メタデータの種類<a class="headerlink" href="#metadata-types" title="このヘッドラインへのパーマリンク">¶</a></h2>
<dl class="class">
<dt id="IndexMetadata">
<em class="property">class </em><code class="descname">IndexMetadata</code><span class="sig-paren">(</span><em>name</em>, <em>sql</em>, <em>columns</em>, <em>unique</em>, <em>table</em><span class="sig-paren">)</span><a class="headerlink" href="#IndexMetadata" title="この定義へのパーマリンク">¶</a></dt>
<dd><dl class="attribute">
<dt id="IndexMetadata.name">
<code class="descname">name</code><a class="headerlink" href="#IndexMetadata.name" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The name of the index.</p>
</dd></dl>

<dl class="attribute">
<dt id="IndexMetadata.sql">
<code class="descname">sql</code><a class="headerlink" href="#IndexMetadata.sql" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The SQL query used to generate the index.</p>
</dd></dl>

<dl class="attribute">
<dt id="IndexMetadata.columns">
<code class="descname">columns</code><a class="headerlink" href="#IndexMetadata.columns" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>A list of columns that are covered by the index.</p>
</dd></dl>

<dl class="attribute">
<dt id="IndexMetadata.unique">
<code class="descname">unique</code><a class="headerlink" href="#IndexMetadata.unique" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>A boolean value indicating whether the index has a unique constraint.</p>
</dd></dl>

<dl class="attribute">
<dt id="IndexMetadata.table">
<code class="descname">table</code><a class="headerlink" href="#IndexMetadata.table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The name of the table containing this index.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ColumnMetadata">
<em class="property">class </em><code class="descname">ColumnMetadata</code><span class="sig-paren">(</span><em>name</em>, <em>data_type</em>, <em>null</em>, <em>primary_key</em>, <em>table</em><span class="sig-paren">)</span><a class="headerlink" href="#ColumnMetadata" title="この定義へのパーマリンク">¶</a></dt>
<dd><dl class="attribute">
<dt id="ColumnMetadata.name">
<code class="descname">name</code><a class="headerlink" href="#ColumnMetadata.name" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The name of the column.</p>
</dd></dl>

<dl class="attribute">
<dt id="ColumnMetadata.data_type">
<code class="descname">data_type</code><a class="headerlink" href="#ColumnMetadata.data_type" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The data type of the column</p>
</dd></dl>

<dl class="attribute">
<dt id="ColumnMetadata.null">
<code class="descname">null</code><a class="headerlink" href="#ColumnMetadata.null" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>A boolean value indicating whether <code class="docutils literal"><span class="pre">NULL</span></code> is permitted in this column.</p>
</dd></dl>

<dl class="attribute">
<dt id="ColumnMetadata.primary_key">
<code class="descname">primary_key</code><a class="headerlink" href="#ColumnMetadata.primary_key" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>A boolean value indicating whether this column is a primary key.</p>
</dd></dl>

<dl class="attribute">
<dt id="ColumnMetadata.table">
<code class="descname">table</code><a class="headerlink" href="#ColumnMetadata.table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The name of the table containing this column.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="ForeignKeyMetadata">
<em class="property">class </em><code class="descname">ForeignKeyMetadata</code><span class="sig-paren">(</span><em>column</em>, <em>dest_table</em>, <em>dest_column</em>, <em>table</em><span class="sig-paren">)</span><a class="headerlink" href="#ForeignKeyMetadata" title="この定義へのパーマリンク">¶</a></dt>
<dd><dl class="attribute">
<dt id="ForeignKeyMetadata.column">
<code class="descname">column</code><a class="headerlink" href="#ForeignKeyMetadata.column" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The column containing the foreign key (the 「source」).</p>
</dd></dl>

<dl class="attribute">
<dt id="ForeignKeyMetadata.dest_table">
<code class="descname">dest_table</code><a class="headerlink" href="#ForeignKeyMetadata.dest_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The table referenced by the foreign key.</p>
</dd></dl>

<dl class="attribute">
<dt id="ForeignKeyMetadata.dest_column">
<code class="descname">dest_column</code><a class="headerlink" href="#ForeignKeyMetadata.dest_column" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The column referenced by the foreign key (on <code class="docutils literal"><span class="pre">dest_table</span></code>).</p>
</dd></dl>

<dl class="attribute">
<dt id="ForeignKeyMetadata.table">
<code class="descname">table</code><a class="headerlink" href="#ForeignKeyMetadata.table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The name of the table containing this foreign key.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="misc">
<h2>その他<a class="headerlink" href="#misc" title="このヘッドラインへのパーマリンク">¶</a></h2>
<dl class="class">
<dt id="fn">
<em class="property">class </em><code class="descname">fn</code><a class="headerlink" href="#fn" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>A helper class that will convert arbitrary function calls to SQL function calls.</p>
<p>To express functions in peewee, use the <a class="reference internal" href="#fn" title="fn"><code class="xref py py-class docutils literal"><span class="pre">fn</span></code></a> object.  The way it works is
anything to the right of the 「dot」 operator will be treated as a function.  You can
pass that function arbitrary parameters which can be other valid expressions.</p>
<p>For example:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Peewee expression</th>
<th class="head">Equivalent SQL</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">fn.Count(Tweet.id).alias('count')</span></code></td>
<td><code class="docutils literal"><span class="pre">Count(t1.&quot;id&quot;)</span> <span class="pre">AS</span> <span class="pre">count</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">fn.Lower(fn.Substr(User.username,</span> <span class="pre">1,</span> <span class="pre">1))</span></code></td>
<td><code class="docutils literal"><span class="pre">Lower(Substr(t1.&quot;username&quot;,</span> <span class="pre">1,</span> <span class="pre">1))</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">fn.Rand().alias('random')</span></code></td>
<td><code class="docutils literal"><span class="pre">Rand()</span> <span class="pre">AS</span> <span class="pre">random</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">fn.Stddev(Employee.salary).alias('sdv')</span></code></td>
<td><code class="docutils literal"><span class="pre">Stddev(t1.&quot;salary&quot;)</span> <span class="pre">AS</span> <span class="pre">sdv</span></code></td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="fn.over">
<code class="descname">over</code><span class="sig-paren">(</span><span class="optional">[</span><em>partition_by=None</em><span class="optional">[</span>, <em>order_by=None</em><span class="optional">[</span>, <em>start=None</em><span class="optional">[</span>, <em>end=None</em><span class="optional">[</span>, <em>window=None</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#fn.over" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Basic support for SQL window functions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>partition_by</strong> (<em>list</em>) – List of <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> instances to partition by.</li>
<li><strong>order_by</strong> (<em>list</em>) – List of <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> instances to use for ordering.</li>
<li><strong>start</strong> – The start of the <em>frame</em> of the window query.</li>
<li><strong>end</strong> – The end of the <em>frame</em> of the window query.</li>
<li><strong>window</strong> (<a class="reference internal" href="#Window" title="Window"><em>Window</em></a>) – A <a class="reference internal" href="#Window" title="Window"><code class="xref py py-class docutils literal"><span class="pre">Window</span></code></a> instance to use for this aggregate.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Get the list of employees and the average salary for their dept.</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Employee</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">department</span><span class="p">,</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">,</span>
             <span class="n">fn</span><span class="o">.</span><span class="n">Avg</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span>
                 <span class="n">partition_by</span><span class="o">=</span><span class="p">[</span><span class="n">Employee</span><span class="o">.</span><span class="n">department</span><span class="p">]))</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

<span class="c1"># Rank employees by salary.</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Employee</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">,</span>
             <span class="n">fn</span><span class="o">.</span><span class="n">rank</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span>
                 <span class="n">order_by</span><span class="o">=</span><span class="p">[</span><span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">])))</span>

<span class="c1"># Get a list of page-views, along with avg pageviews for that day.</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">PageView</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span>
             <span class="n">PageView</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
             <span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
             <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span>
                 <span class="n">partition_by</span><span class="o">=</span><span class="p">[</span><span class="n">fn</span><span class="o">.</span><span class="n">date_trunc</span><span class="p">(</span>
                     <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)]))</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span>

<span class="c1"># Same as above but using a window class.</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="p">(</span><span class="n">partition_by</span><span class="o">=</span><span class="p">[</span><span class="n">fn</span><span class="o">.</span><span class="n">date_trunc</span><span class="p">(</span><span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)])</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">PageView</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span>
             <span class="n">PageView</span><span class="o">.</span><span class="n">url</span><span class="p">,</span>
             <span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">,</span>
             <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">))</span>
         <span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>  <span class="c1"># Need to include our Window here.</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">PageView</span><span class="o">.</span><span class="n">timestamp</span><span class="p">))</span>

<span class="c1"># Get the list of times along with the last time.</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Times</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span>
              <span class="n">Times</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
              <span class="n">fn</span><span class="o">.</span><span class="n">LAST_VALUE</span><span class="p">(</span><span class="n">Times</span><span class="o">.</span><span class="n">time</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span>
                  <span class="n">order_by</span><span class="o">=</span><span class="p">[</span><span class="n">Times</span><span class="o">.</span><span class="n">time</span><span class="p">],</span>
                  <span class="n">start</span><span class="o">=</span><span class="n">Window</span><span class="o">.</span><span class="n">preceding</span><span class="p">(),</span>
                  <span class="n">end</span><span class="o">=</span><span class="n">Window</span><span class="o">.</span><span class="n">following</span><span class="p">())))</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="SQL">
<em class="property">class </em><code class="descname">SQL</code><span class="sig-paren">(</span><em>sql</em>, <em>*params</em><span class="sig-paren">)</span><a class="headerlink" href="#SQL" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Add fragments of SQL to a peewee query.  For example you might want to reference
an aliased name.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>sql</strong> (<em>str</em>) – Arbitrary SQL string.</li>
<li><strong>params</strong> – Arbitrary query parameters.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Retrieve user table and &quot;annotate&quot; it with a count of tweets for each</span>
<span class="c1"># user.</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">User</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">fn</span><span class="o">.</span><span class="n">Count</span><span class="p">(</span><span class="n">Tweet</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;ct&#39;</span><span class="p">))</span>
         <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Tweet</span><span class="p">,</span> <span class="n">JOIN</span><span class="o">.</span><span class="n">LEFT_OUTER</span><span class="p">)</span>
         <span class="o">.</span><span class="n">group_by</span><span class="p">(</span><span class="n">User</span><span class="p">))</span>

<span class="c1"># Sort the users by number of tweets.</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">SQL</span><span class="p">(</span><span class="s1">&#39;ct DESC&#39;</span><span class="p">))</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="Window">
<em class="property">class </em><code class="descname">Window</code><span class="sig-paren">(</span><span class="optional">[</span><em>partition_by=None</em><span class="optional">[</span>, <em>order_by=None</em><span class="optional">[</span>, <em>start=None</em><span class="optional">[</span>, <em>end=None</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Window" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Create a <code class="docutils literal"><span class="pre">WINDOW</span></code> definition.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>partition_by</strong> (<em>list</em>) – List of <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> instances to partition by.</li>
<li><strong>order_by</strong> (<em>list</em>) – List of <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> instances to use for ordering.</li>
<li><strong>start</strong> – The start of the <em>frame</em> of the window query.</li>
<li><strong>end</strong> – The end of the <em>frame</em> of the window query.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Examples:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Get the list of employees and the average salary for their dept.</span>
<span class="n">window</span> <span class="o">=</span> <span class="n">Window</span><span class="p">(</span><span class="n">partition_by</span><span class="o">=</span><span class="p">[</span><span class="n">Employee</span><span class="o">.</span><span class="n">department</span><span class="p">])</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s1">&#39;dept_w&#39;</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">Employee</span>
         <span class="o">.</span><span class="n">select</span><span class="p">(</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">department</span><span class="p">,</span>
             <span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">,</span>
             <span class="n">fn</span><span class="o">.</span><span class="n">Avg</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">salary</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">window</span><span class="p">))</span>
         <span class="o">.</span><span class="n">window</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
         <span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Employee</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</pre></div>
</div>
<dl class="staticmethod">
<dt id="Window.preceding">
<em class="property">static </em><code class="descname">preceding</code><span class="sig-paren">(</span><span class="optional">[</span><em>value=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Window.preceding" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Return an expression appropriate for passing in to the <code class="docutils literal"><span class="pre">start</span></code> or
<code class="docutils literal"><span class="pre">end</span></code> clause of a <a class="reference internal" href="#Window" title="Window"><code class="xref py py-class docutils literal"><span class="pre">Window</span></code></a> object. If <code class="docutils literal"><span class="pre">value</span></code> is not
provided, then it will be <code class="docutils literal"><span class="pre">UNBOUNDED</span> <span class="pre">PRECEDING</span></code>.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="Window.following">
<em class="property">static </em><code class="descname">following</code><span class="sig-paren">(</span><span class="optional">[</span><em>value=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Window.following" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Return an expression appropriate for passing in to the <code class="docutils literal"><span class="pre">start</span></code> or
<code class="docutils literal"><span class="pre">end</span></code> clause of a <a class="reference internal" href="#Window" title="Window"><code class="xref py py-class docutils literal"><span class="pre">Window</span></code></a> object. If <code class="docutils literal"><span class="pre">value</span></code> is not
provided, then it will be <code class="docutils literal"><span class="pre">UNBOUNDED</span> <span class="pre">FOLLOWING</span></code>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="DeferredRelation">
<em class="property">class </em><code class="descname">DeferredRelation</code><a class="headerlink" href="#DeferredRelation" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Used to reference a not-yet-created model class. Stands in as a placeholder for the related model of a foreign key. Useful for circular references.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">DeferredPost</span> <span class="o">=</span> <span class="n">DeferredRelation</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

    <span class="c1"># `Post` is not available yet, it is declared below.</span>
    <span class="n">favorite_post</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">DeferredPost</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># `Post` comes after `User` since it refers to `User`.</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">ForeignKeyField</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="n">DeferredPost</span><span class="o">.</span><span class="n">set_model</span><span class="p">(</span><span class="n">Post</span><span class="p">)</span>  <span class="c1"># Post is now available.</span>
</pre></div>
</div>
<dl class="method">
<dt id="DeferredRelation.set_model">
<code class="descname">set_model</code><span class="sig-paren">(</span><em>model</em><span class="sig-paren">)</span><a class="headerlink" href="#DeferredRelation.set_model" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Replace the placeholder with the correct model class.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="Proxy">
<em class="property">class </em><code class="descname">Proxy</code><a class="headerlink" href="#Proxy" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Proxy class useful for situations when you wish to defer the initialization of
an object.  For instance, you want to define your models but you do not know
what database engine you will be using until runtime.</p>
<p>例:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">database_proxy</span> <span class="o">=</span> <span class="n">Proxy</span><span class="p">()</span>  <span class="c1"># Create a proxy for our db.</span>

<span class="k">class</span> <span class="nc">BaseModel</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">database</span> <span class="o">=</span> <span class="n">database_proxy</span>  <span class="c1"># Use proxy for our DB.</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">CharField</span><span class="p">()</span>

<span class="c1"># Based on configuration, use a different database.</span>
<span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">]:</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s1">&#39;local.db&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;TESTING&#39;</span><span class="p">]:</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">SqliteDatabase</span><span class="p">(</span><span class="s1">&#39;:memory:&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">PostgresqlDatabase</span><span class="p">(</span><span class="s1">&#39;mega_production_db&#39;</span><span class="p">)</span>

<span class="c1"># Configure our proxy to use the db we specified in config.</span>
<span class="n">database_proxy</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">database</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<dl class="method">
<dt id="Proxy.initialize">
<code class="descname">initialize</code><span class="sig-paren">(</span><em>obj</em><span class="sig-paren">)</span><a class="headerlink" href="#Proxy.initialize" title="この定義へのパーマリンク">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><strong>obj</strong> – The object to proxy to.</td>
</tr>
</tbody>
</table>
<p>Once initialized, the attributes and methods on <code class="docutils literal"><span class="pre">obj</span></code> can be accessed
directly via the <a class="reference internal" href="#Proxy" title="Proxy"><code class="xref py py-class docutils literal"><span class="pre">Proxy</span></code></a> instance.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="Node">
<em class="property">class </em><code class="descname">Node</code><a class="headerlink" href="#Node" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>The <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> class is the parent class for all composable parts of a query, and forms the basis of peewee’s expression API. The following classes extend <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a>:</p>
<ul class="simple">
<li><a class="reference internal" href="#SelectQuery" title="SelectQuery"><code class="xref py py-class docutils literal"><span class="pre">SelectQuery</span></code></a>, <a class="reference internal" href="#UpdateQuery" title="UpdateQuery"><code class="xref py py-class docutils literal"><span class="pre">UpdateQuery</span></code></a>, <a class="reference internal" href="#InsertQuery" title="InsertQuery"><code class="xref py py-class docutils literal"><span class="pre">InsertQuery</span></code></a>, <a class="reference internal" href="#DeleteQuery" title="DeleteQuery"><code class="xref py py-class docutils literal"><span class="pre">DeleteQuery</span></code></a>, and <a class="reference internal" href="#RawQuery" title="RawQuery"><code class="xref py py-class docutils literal"><span class="pre">RawQuery</span></code></a>.</li>
<li><code class="xref py py-class docutils literal"><span class="pre">Field</span></code></li>
<li><code class="xref py py-class docutils literal"><span class="pre">Func</span></code> (and <a class="reference internal" href="#fn" title="fn"><code class="xref py py-func docutils literal"><span class="pre">fn()</span></code></a>)</li>
<li><a class="reference internal" href="#SQL" title="SQL"><code class="xref py py-class docutils literal"><span class="pre">SQL</span></code></a></li>
<li><code class="xref py py-class docutils literal"><span class="pre">Expression</span></code></li>
<li><code class="xref py py-class docutils literal"><span class="pre">Param</span></code></li>
<li><a class="reference internal" href="#Window" title="Window"><code class="xref py py-class docutils literal"><span class="pre">Window</span></code></a></li>
<li><code class="xref py py-class docutils literal"><span class="pre">Clause</span></code></li>
<li><code class="xref py py-class docutils literal"><span class="pre">Entity</span></code></li>
<li><code class="xref py py-class docutils literal"><span class="pre">Check</span></code></li>
</ul>
<p>Overridden operators:</p>
<ul class="simple">
<li>Bitwise and- and or- (<code class="docutils literal"><span class="pre">&amp;</span></code> and <code class="docutils literal"><span class="pre">|</span></code>): combine multiple nodes using the given conjunction.</li>
<li><code class="docutils literal"><span class="pre">+</span></code>, <code class="docutils literal"><span class="pre">-</span></code>, <code class="docutils literal"><span class="pre">*</span></code>, <code class="docutils literal"><span class="pre">/</span></code> and <code class="docutils literal"><span class="pre">^</span></code> (add, subtract, multiply, divide and exclusive-or).</li>
<li><code class="docutils literal"><span class="pre">==</span></code>, <code class="docutils literal"><span class="pre">!=</span></code>, <code class="docutils literal"><span class="pre">&lt;</span></code>, <code class="docutils literal"><span class="pre">&lt;=</span></code>, <code class="docutils literal"><span class="pre">&gt;</span></code>, <code class="docutils literal"><span class="pre">&gt;=</span></code>: create a binary expression using the given comparator.</li>
<li><code class="docutils literal"><span class="pre">&lt;&lt;</span></code>: create an <em>IN</em> expression.</li>
<li><code class="docutils literal"><span class="pre">&gt;&gt;</span></code>: create an <em>IS</em> expression.</li>
<li><code class="docutils literal"><span class="pre">%</span></code> and <code class="docutils literal"><span class="pre">**</span></code>: <em>LIKE</em> and <em>ILIKE</em>.</li>
</ul>
<dl class="method">
<dt id="Node.contains">
<code class="descname">contains</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.contains" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Create a binary expression using case-insensitive string search.</p>
</dd></dl>

<dl class="method">
<dt id="Node.startswith">
<code class="descname">startswith</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.startswith" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Create a binary expression using case-insensitive prefix search.</p>
</dd></dl>

<dl class="method">
<dt id="Node.endswith">
<code class="descname">endswith</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.endswith" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Create a binary expression using case-insensitive suffix search.</p>
</dd></dl>

<dl class="method">
<dt id="Node.between">
<code class="descname">between</code><span class="sig-paren">(</span><em>low</em>, <em>high</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.between" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Create an expression that will match values between <code class="docutils literal"><span class="pre">low</span></code> and <code class="docutils literal"><span class="pre">high</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="Node.regexp">
<code class="descname">regexp</code><span class="sig-paren">(</span><em>expression</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.regexp" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Match based on regular expression.</p>
</dd></dl>

<dl class="method">
<dt id="Node.concat">
<code class="descname">concat</code><span class="sig-paren">(</span><em>rhs</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.concat" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Concatenate the current node with the provided <code class="docutils literal"><span class="pre">rhs</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">警告</p>
<p>In order for this method to work with MySQL, the MySQL session must
be set to use <code class="docutils literal"><span class="pre">PIPES_AS_CONCAT</span></code>.</p>
<p class="last">To reliably concatenate strings with MySQL, use
<code class="docutils literal"><span class="pre">fn.CONCAT(s1,</span> <span class="pre">s2...)</span></code> instead.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="Node.is_null">
<code class="descname">is_null</code><span class="sig-paren">(</span><span class="optional">[</span><em>is_null=True</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Node.is_null" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Create an expression testing whether the <code class="docutils literal"><span class="pre">Node</span></code> is (or is not) <code class="docutils literal"><span class="pre">NULL</span></code>.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Find all categories whose parent column is NULL.</span>
<span class="n">root_nodes</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_null</span><span class="p">())</span>

<span class="c1"># Find all categores whose parent is NOT NULL.</span>
<span class="n">child_nodes</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">is_null</span><span class="p">(</span><span class="bp">False</span><span class="p">))</span>
</pre></div>
</div>
<p>To simplify things, peewee will generate the correct SQL for equality and inequality. The <a class="reference internal" href="#Node.is_null" title="Node.is_null"><code class="xref py py-meth docutils literal"><span class="pre">is_null()</span></code></a> method is provided simply for readability.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Equivalent to the previous queries -- peewee will translate these</span>
<span class="c1"># into `IS NULL` and `IS NOT NULL`:</span>
<span class="n">root_nodes</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">parent</span> <span class="o">==</span> <span class="bp">None</span><span class="p">)</span>
<span class="n">child_nodes</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">select</span><span class="p">()</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Category</span><span class="o">.</span><span class="n">parent</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="Node.__invert__">
<code class="descname">__invert__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Node.__invert__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Negate the node. This translates roughly into <em>NOT (&lt;node&gt;)</em>.</p>
</dd></dl>

<dl class="method">
<dt id="Node.alias">
<code class="descname">alias</code><span class="sig-paren">(</span><span class="optional">[</span><em>name=None</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Node.alias" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Apply an alias to the given node. This translates into <em>&lt;node&gt; AS &lt;name&gt;</em>.</p>
</dd></dl>

<dl class="method">
<dt id="Node.asc">
<code class="descname">asc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Node.asc" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Apply ascending ordering to the given node. This translates into <em>&lt;node&gt; ASC</em>.</p>
</dd></dl>

<dl class="method">
<dt id="Node.desc">
<code class="descname">desc</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Node.desc" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Apply descending ordering to the given node. This translates into <em>&lt;node&gt; DESC</em>.</p>
</dd></dl>

<dl class="method">
<dt id="Node.bind_to">
<code class="descname">bind_to</code><span class="sig-paren">(</span><em>model_class</em><span class="sig-paren">)</span><a class="headerlink" href="#Node.bind_to" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Bind the results of an expression to a specific model type. Useful when adding expressions to a select, where the result of the expression should be placed on a particular joined instance.</p>
</dd></dl>

<dl class="classmethod">
<dt id="Node.extend">
<em class="property">classmethod </em><code class="descname">extend</code><span class="sig-paren">(</span><span class="optional">[</span><em>name=None</em><span class="optional">[</span>, <em>clone=False</em><span class="optional">]</span><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#Node.extend" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Decorator for adding the decorated function as a new method on <a class="reference internal" href="#Node" title="Node"><code class="xref py py-class docutils literal"><span class="pre">Node</span></code></a> and its subclasses. Useful for adding implementation-specific features to all node types.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">パラメータ:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<em>str</em>) – Method name. If not provided the name of the wrapped function will be used.</li>
<li><strong>clone</strong> (<em>bool</em>) – Whether this method should return a clone. This is generally true when the method mutates the internal state of the node.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>例:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Add a `cast()` method to all nodes using the &#39;::&#39; operator.</span>
<span class="n">PostgresqlDatabase</span><span class="o">.</span><span class="n">register_ops</span><span class="p">({</span><span class="s1">&#39;::&#39;</span><span class="p">,</span> <span class="s1">&#39;::&#39;</span><span class="p">})</span>

<span class="nd">@Node.extend</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">cast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">as_type</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Expression</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;::&#39;</span><span class="p">,</span> <span class="n">SQL</span><span class="p">(</span><span class="n">as_type</span><span class="p">))</span>

<span class="c1"># Let&#39;s pretend we want to find all data points whose numbers</span>
<span class="c1"># are palindromes. Note that we can use the new *cast* method</span>
<span class="c1"># on both fields and with the `fn` helper:</span>
<span class="n">reverse_val</span> <span class="o">=</span> <span class="n">fn</span><span class="o">.</span><span class="n">REVERSE</span><span class="p">(</span><span class="n">DataModel</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="p">(</span><span class="n">DataPoint</span>
         <span class="o">.</span><span class="n">select</span><span class="p">()</span>
         <span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">DataPoint</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">reverse_val</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">注釈</p>
<p class="last">To remove an extended method, simply call <code class="docutils literal"><span class="pre">delattr</span></code> on the class the method was originally added to.</p>
</div>
</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="hacks.html" class="btn btn-neutral float-right" title="Hacks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="playhouse.html" class="btn btn-neutral" title="Playhouse。Peeweeへの拡張" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright charles leifer.

    </p>
  </div>
 

<div role="contentinfo">
<p>このサイトは<a href="http://a-zumi.net">あずみ.net</a>が翻訳しております。</p>
<p>サイトを利用したことによる直接的、付随的、結果的、間接的、あるいは懲罰的な損害、経費、損失、または
債務について、いかなる責任も負いかねます。</p>
</div>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.10.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-23705195-42"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-23705195-42');
</script>


</body>
</html>